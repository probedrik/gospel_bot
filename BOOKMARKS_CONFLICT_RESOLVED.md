# ‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∑–∞–∫–ª–∞–¥–æ–∫ —Ä–µ—à–µ–Ω

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ò–∑ –ª–æ–≥–æ–≤ –±—ã–ª–æ –≤–∏–¥–Ω–æ, —á—Ç–æ —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `bookmark_selected` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–ª –Ω–æ–≤—ã–µ callback_data –∏ –ø–∞–¥–∞–ª —Å –æ—à–∏–±–∫–æ–π:
```
ERROR: invalid literal for int() with base 10: 'add'
ERROR: invalid literal for int() with base 10: 'remove'
```

## üîç –ü—Ä–∏—á–∏–Ω–∞
–°—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `F.data.startswith("bookmark_")`, —á—Ç–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–ª –í–°–ï callback_data, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "bookmark_", –≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- `bookmark_add_20_3_0_5_6` (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
- `bookmark_remove_48_3_0_0_0` (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
- `bookmark_48_3` (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**
–í `handlers/bookmark_callbacks.py`:

```python
# –ë–´–õ–û:
@router.callback_query(F.data.startswith("bookmark_"))
async def bookmark_selected(callback: CallbackQuery, state: FSMContext, db=None):

# –°–¢–ê–õ–û:
@router.callback_query(F.data.regexp(r'^bookmark_(\d+)_(\d+)$'))
async def bookmark_selected(callback: CallbackQuery, state: FSMContext, db=None):
```

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞**
–í `handlers/bookmark_handlers.py`:

```python
# –ë–´–õ–û:
@router.callback_query(F.data.regexp(r'^bookmark_(add|remove)_\d+_\d+_\d+_\d+(_\d+)?$'))

# –°–¢–ê–õ–û:
@router.callback_query(F.data.regexp(r'^bookmark_(add|remove)_\d+_\d+_\d+_\d+_\d+$'))
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π

### –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (`handle_bookmark_action`):
- ‚úÖ `bookmark_add_20_3_0_5_6` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏—Ö –ü—Ä–∏—Ç 3:5-6
- ‚úÖ `bookmark_remove_48_3_0_0_0` ‚Üí —É–¥–∞–ª–∏—Ç—å –≥–ª–∞–≤—É 1 –ò–Ω 3
- ‚úÖ `bookmark_add_1_1_3_0_0` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –≥–ª–∞–≤ –ë—ã—Ç 1-3

### –°—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (`bookmark_selected`):
- ‚úÖ `bookmark_48_3` ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–∫–ª–∞–¥–∫—É 1 –ò–Ω 3
- ‚úÖ `bookmark_1_21` ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–∫–ª–∞–¥–∫—É –ë—ã—Ç 21

### –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
- ‚ùå `bookmark_info` ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º
- ‚ùå `add_bookmark_48_3` ‚Üí —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. **–ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫–ª–∞–¥–æ–∫** ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è `handle_bookmark_action`
2. **–°—Ç–∞—Ä—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏ –∏–∑ —Å–ø–∏—Å–∫–∞** ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è `bookmark_selected`
3. **–ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** ‚Üí –∫–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π —Ñ–æ—Ä–º–∞—Ç

### üì± –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–æ–∫** ‚Üí `bookmark_add_*` ‚Üí –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- **–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–æ–∫** ‚Üí `bookmark_remove_*` ‚Üí –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- **–û—Ç–∫—Ä—ã—Ç–∏–µ –∑–∞–∫–ª–∞–¥–æ–∫** ‚Üí `bookmark_{book_id}_{chapter}` ‚Üí —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

### üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫:
- **üìå –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–∫–ª–∞–¥–∫–∏** ‚Üí **üîñ –£–¥–∞–ª–∏—Ç—å –∏–∑ –∑–∞–∫–ª–∞–¥–æ–∫**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ `check_if_bookmarked`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üìã –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏

### ‚úÖ SQLite (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚úÖ Supabase (–ø—Ä–æ–¥–∞–∫—à–Ω):
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚úÖ
- –ü–æ–ª—è `chapter_start` –∏ `chapter_end` –¥–æ–±–∞–≤–ª–µ–Ω—ã
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ

## üéâ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!

### –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ –∑–∞–∫–ª–∞–¥–æ–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–∑–¥–µ:
1. ‚úÖ **–ì–ª–∞–≤—ã –ë–∏–±–ª–∏–∏** - –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)
2. ‚úÖ **–°—Ç–∏—Ö–∏ –≤ –ò–ò –ø–æ–º–æ—â–Ω–∏–∫–µ** - –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∏—Ö–æ–≤
3. ‚úÖ **–†–∞–∑–±–æ—Ä –ò–ò** - –¥–ª—è —Ç–æ–ª–∫—É–µ–º—ã—Ö —Å—Ç–∏—Ö–æ–≤ –∏ –≥–ª–∞–≤
4. ‚úÖ **–°—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–∏—Ö–∏** - –ø—Ä–∏ –≤–≤–æ–¥–µ "–ò–Ω 3:16"
5. ‚úÖ **–û—Ç—Ä—ã–≤–∫–∏ –∏–∑ —Ç–µ–º** - –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–∑ –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ–º
6. ‚úÖ **–û—Ç—Ä—ã–≤–∫–∏ –∏–∑ –ø–ª–∞–Ω–æ–≤ —á—Ç–µ–Ω–∏—è** - –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –ø–ª–∞–Ω–æ–≤
7. ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–ª–∞–¥–æ–∫** - "üìù –ú–æ–∏ –∑–∞–∫–ª–∞–¥–∫–∏" —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- **–û–¥–∏–Ω–æ—á–Ω—ã–µ –≥–ª–∞–≤—ã**: "–ë—ã—Ç–∏–µ 1"
- **–î–∏–∞–ø–∞–∑–æ–Ω—ã –≥–ª–∞–≤**: "–ë—ã—Ç–∏–µ 1-3"
- **–û–¥–∏–Ω–æ—á–Ω—ã–µ —Å—Ç–∏—Ö–∏**: "–ò–æ–∞–Ω–Ω 3:16"
- **–î–∏–∞–ø–∞–∑–æ–Ω—ã —Å—Ç–∏—Ö–æ–≤**: "–ò–æ–∞–Ω–Ω 3:16-18"

**–°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–ª–∞–¥–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéØ

## üîß –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–∞–∫–ª–∞–¥–∫–∏:
```python
from utils.bookmark_utils import create_bookmark_button
from handlers.bookmark_handlers import check_if_bookmarked

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
is_bookmarked = await check_if_bookmarked(
    user_id, book_id, chapter_start, chapter_end, verse_start, verse_end
)

# –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É
button = create_bookmark_button(
    book_id=book_id,
    chapter_start=chapter_start,
    chapter_end=chapter_end,
    verse_start=verse_start,
    verse_end=verse_end,
    is_bookmarked=is_bookmarked
)

# –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
buttons.append([button])
```

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –î–æ–±–∞–≤–ª—è—é—Ç/—É–¥–∞–ª—è—é—Ç –∑–∞–∫–ª–∞–¥–∫–∏ –≤ –ë–î
- –û–±–Ω–æ–≤–ª—è—é—Ç –∫–Ω–æ–ø–∫—É –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é