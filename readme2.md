# Описание Telegram-бота для чтения Библии

Этот проект — Telegram-бот для чтения Библии, написанный с использованием библиотеки aiogram (асинхронный фреймворк для Telegram-ботов на Python).

## Основные задачи и функции

1. **Запуск и инициализация**  
   - Логирует запуск инициализации.
   - Проверяет и инициализирует базу данных (создаёт директории, проверяет доступ к файлу, создаёт таблицы, тестирует добавление и получение пользователя).
   - Если с БД что-то не так — пишет об ошибке, но продолжает работу (бот может работать и без БД, но с ограничениями).

2. **Инициализация компонентов aiogram**  
   - Создаёт объект бота с токеном и настройками парсинга HTML.
   - Создаёт диспетчер (Dispatcher) с in-memory хранилищем состояний (MemoryStorage).

3. **Работа с базой данных**  
   - Проверяет соединение с БД.
   - Экземпляр менеджера БД (`db_manager`) сохраняется в контексте диспетчера для доступа из обработчиков.

4. **Middleware**  
   - Подключает middleware для работы с состояниями и базой данных (StateMiddleware, DatabaseMiddleware).

5. **Регистрация обработчиков**  
   - Подключает роутеры с обработчиками команд, текстовых сообщений, callback-запросов, закладок и callback-запросов для закладок.
   - Это значит, что бот умеет реагировать на команды, обычные сообщения, нажатия на inline-кнопки и управлять закладками.

6. **Запуск polling**  
   - Удаляет старый webhook (если был).
   - Запускает polling (бот начинает получать обновления от Telegram).
   - Обрабатывает исключения, логирует ошибки.

7. **Завершение работы**  
   - При остановке закрывает соединение с базой данных.
   - Логирует завершение работы.

## Структура и архитектура

- **handlers** — модуль с обработчиками (команды, текст, callback, закладки).
- **middleware** — промежуточные слои для передачи состояния и работы с БД.
- **database** — менеджер работы с БД (создание, добавление, получение пользователей и т.д.).
- **config** — настройки, в том числе токен бота.

## Для чего нужен этот бот?

- **Чтение Библии** — бот позволяет пользователю читать тексты Библии, искать главы/стихи, возможно, делать закладки.
- **Закладки** — пользователь может сохранять любимые места.
- **Асинхронная работа** — бот может обрабатывать много пользователей одновременно.
- **Логирование** — все действия и ошибки записываются в файл и выводятся в консоль.

## Кратко

Этот бот — это телеграм-бот для чтения Библии с поддержкой закладок, асинхронной обработкой сообщений, хранением данных в базе и удобной архитектурой на aiogram. Он хорошо структурирован, устойчив к ошибкам с БД и легко расширяем за счёт роутеров и middleware. 