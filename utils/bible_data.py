"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –ë–∏–±–ª–∏–∏ (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Excel, —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π).
"""
import logging
import pandas as pd
from typing import Dict, List, Tuple, Optional
from datetime import datetime

from config.settings import EXCEL_FILES

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–≥–µ—Ä–∞
logger = logging.getLogger(__name__)


class BibleData:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –ë–∏–±–ª–∏–∏."""

    def __init__(self):
        self.books_df = None
        self.plan_df = None
        self.book_names = []
        self.book_values = []
        self.book_dict = {}
        self.books = {}  # –ê—Ç—Ä–∏–±—É—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

        # –°–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π –∫–Ω–∏–≥ –∏ –∏—Ö ID
        self.book_abbr_dict = {
            "–ë—ã—Ç": 1, "–ò—Å—Ö": 2, "–õ–µ–≤": 3, "–ß–∏—Å": 4, "–í—Ç–æ—Ä": 5, "–ù–∞–≤": 6, "–°—É–¥": 7, "–†—É—Ñ": 8,
            "1–¶–∞—Ä": 9, "2–¶–∞—Ä": 10, "3–¶–∞—Ä": 11, "4–¶–∞—Ä": 12, "1–ü–∞—Ä": 13, "2–ü–∞—Ä": 14, "–ï–∑–¥": 15,
            "–ù–µ–µ–º": 16, "–ï—Å—Ñ": 17, "–ò–æ–≤": 18, "–ü—Å": 19, "–ü—Ä–∏—Ç": 20, "–ï–∫–∫–ª": 21, "–ü–µ—Å–Ω": 22,
            "–ò—Å": 23, "–ò–µ—Ä": 24, "–ü–ª–∞—á": 25, "–ò–µ–∑": 26, "–î–∞–Ω": 27, "–û—Å": 28, "–ò–æ–∏–ª": 29,
            "–ê–º": 30, "–ê–≤–¥": 31, "–ò–æ–Ω": 32, "–ú–∏—Ö": 33, "–ù–∞—É–º": 34, "–ê–≤–≤": 35, "–°–æ—Ñ": 36,
            "–ê–≥–≥": 37, "–ó–∞—Ö": 38, "–ú–∞–ª": 39, "–ú—Ñ": 40, "–ú–∫": 41, "–õ–∫": 42, "–ò–Ω": 43,
            "–î–µ—è–Ω": 44, "–ò–∞–∫": 45, "1–ü–µ—Ç": 46, "2–ü–µ—Ç": 47, "1–ò–Ω": 48, "2–ò–Ω": 49, "3–ò–Ω": 50,
            "–ò—É–¥": 51, "–†–∏–º": 52, "1–ö–æ—Ä": 53, "2–ö–æ—Ä": 54, "–ì–∞–ª": 55, "–ï—Ñ": 56, "–§–ª–ø": 57,
            "–ö–æ–ª": 58, "1–§–µ—Å": 59, "2–§–µ—Å": 60, "1–¢–∏–º": 61, "2–¢–∏–º": 62, "–¢–∏—Ç": 63, "–§–ª–º": 64,
            "–ï–≤—Ä": 65, "–û—Ç–∫—Ä": 66
        }

        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–ª–∞–≤ –≤ –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–µ
        self.max_chapters = {
            # –í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç
            1: 50, 2: 40, 3: 27, 4: 36, 5: 34, 6: 24, 7: 21, 8: 4,
            9: 31, 10: 24, 11: 22, 12: 25, 13: 29, 14: 36, 15: 10,
            16: 13, 17: 10, 18: 42, 19: 150, 20: 31, 21: 12, 22: 8,
            23: 66, 24: 52, 25: 5, 26: 48, 27: 12, 28: 14, 29: 3,
            30: 9, 31: 1, 32: 4, 33: 7, 34: 3, 35: 3, 36: 3,
            37: 2, 38: 14, 39: 4,
            # –ù–æ–≤—ã–π –ó–∞–≤–µ—Ç
            40: 28, 41: 16, 42: 24, 43: 21, 44: 28, 45: 5, 46: 5,
            47: 3, 48: 5, 49: 1, 50: 1, 51: 1, 52: 16, 53: 16,
            54: 13, 55: 6, 56: 6, 57: 4, 58: 4, 59: 5, 60: 3,
            61: 6, 62: 4, 63: 3, 64: 1, 65: 13, 66: 22
        }

        # –°–∏–Ω–æ–Ω–∏–º—ã –Ω–∞–∑–≤–∞–Ω–∏–π –∫–Ω–∏–≥ –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
        self.book_synonyms = {
            # –ï–≤–∞–Ω–≥–µ–ª–∏—è –∏ –ù–æ–≤—ã–π –ó–∞–≤–µ—Ç
            "–º—Ñ": "–ú—Ñ", "–º–∞—Ç—Ñ–µ–π": "–ú—Ñ", "–æ—Ç –º–∞—Ç—Ñ–µ—è": "–ú—Ñ", "–µ–≤–∞–Ω–≥–µ–ª–∏–µ –æ—Ç –º–∞—Ç—Ñ–µ—è": "–ú—Ñ",
            "–º–∫": "–ú–∫", "–º–∞—Ä–∫": "–ú–∫", "–æ—Ç –º–∞—Ä–∫–∞": "–ú–∫", "–µ–≤–∞–Ω–≥–µ–ª–∏–µ –æ—Ç –º–∞—Ä–∫–∞": "–ú–∫",
            "–ª–∫": "–õ–∫", "–ª—É–∫–∞": "–õ–∫", "–æ—Ç –ª—É–∫–∏": "–õ–∫", "–µ–≤–∞–Ω–≥–µ–ª–∏–µ –æ—Ç –ª—É–∫–∏": "–õ–∫",
            "–∏–Ω": "–ò–Ω", "–∏–æ–∞–Ω–Ω": "–ò–Ω", "–æ—Ç –∏–æ–∞–Ω–Ω–∞": "–ò–Ω", "–µ–≤–∞–Ω–≥–µ–ª–∏–µ –æ—Ç –∏–æ–∞–Ω–Ω–∞": "–ò–Ω", "–∏–æ–∞–Ω–Ω–∞": "–ò–Ω",
            "–¥–µ—è–Ω": "–î–µ—è–Ω", "–¥–µ—è–Ω–∏—è": "–î–µ—è–Ω", "–¥–µ—è–Ω–∏—è –∞–ø–æ—Å—Ç–æ–ª–æ–≤": "–î–µ—è–Ω",
            "–∏–∞–∫": "–ò–∞–∫", "–∏–∞–∫–æ–≤": "–ò–∞–∫", "–ø–æ—Å–ª–∞–Ω–∏–µ –∏–∞–∫–æ–≤–∞": "–ò–∞–∫", "—è–∫–æ–≤": "–ò–∞–∫", "–∏–∞–∫–æ–≤–∞": "–ò–∞–∫",
            "1–ø–µ—Ç": "1–ü–µ—Ç", "1 –ø–µ—Ç—Ä–∞": "1–ü–µ—Ç", "–ø–µ—Ä–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –ø–µ—Ç—Ä–∞": "1–ü–µ—Ç", "1 –ø–æ—Å–ª–∞–Ω–∏–µ –ø–µ—Ç—Ä–∞": "1–ü–µ—Ç",
            "2–ø–µ—Ç": "2–ü–µ—Ç", "2 –ø–µ—Ç—Ä–∞": "2–ü–µ—Ç", "–≤—Ç–æ—Ä–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –ø–µ—Ç—Ä–∞": "2–ü–µ—Ç", "2 –ø–æ—Å–ª–∞–Ω–∏–µ –ø–µ—Ç—Ä–∞": "2–ü–µ—Ç",
            "1–∏–Ω": "1–ò–Ω", "1 –∏–æ–∞–Ω–Ω–∞": "1–ò–Ω", "–ø–µ—Ä–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∏–æ–∞–Ω–Ω–∞": "1–ò–Ω",
            "2–∏–Ω": "2–ò–Ω", "2 –∏–æ–∞–Ω–Ω–∞": "2–ò–Ω", "–≤—Ç–æ—Ä–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∏–æ–∞–Ω–Ω–∞": "2–ò–Ω",
            "3–∏–Ω": "3–ò–Ω", "3 –∏–æ–∞–Ω–Ω–∞": "3–ò–Ω", "—Ç—Ä–µ—Ç—å–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∏–æ–∞–Ω–Ω–∞": "3–ò–Ω",
            "–∏—É–¥": "–ò—É–¥", "–∏—É–¥–∞": "–ò—É–¥", "–ø–æ—Å–ª–∞–Ω–∏–µ –∏—É–¥—ã": "–ò—É–¥",
            "—Ä–∏–º": "–†–∏–º", "—Ä–∏–º–ª—è–Ω–∞–º": "–†–∏–º", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ä–∏–º–ª—è–Ω–∞–º": "–†–∏–º",
            "1–∫–æ—Ä": "1–ö–æ—Ä", "1 –∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º": "1–ö–æ—Ä", "–ø–µ—Ä–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∫ –∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º": "1–ö–æ—Ä",
            "2–∫–æ—Ä": "2–ö–æ—Ä", "2 –∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º": "2–ö–æ—Ä", "–≤—Ç–æ—Ä–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∫ –∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º": "2–ö–æ—Ä",
            "–≥–∞–ª": "–ì–∞–ª", "–≥–∞–ª–∞—Ç–∞–º": "–ì–∞–ª", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ –≥–∞–ª–∞—Ç–∞–º": "–ì–∞–ª",
            "–µ—Ñ": "–ï—Ñ", "–µ—Ñ–µ—Å—è–Ω–∞–º": "–ï—Ñ", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ –µ—Ñ–µ—Å—è–Ω–∞–º": "–ï—Ñ",
            "—Ñ–ª–ø": "–§–ª–ø", "—Ñ–∏–ª–∏–ø–ø–∏–π—Ü–∞–º": "–§–ª–ø", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ñ–∏–ª–∏–ø–ø–∏–π—Ü–∞–º": "–§–ª–ø",
            "–∫–æ–ª": "–ö–æ–ª", "–∫–æ–ª–æ—Å—Å—è–Ω–∞–º": "–ö–æ–ª", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ –∫–æ–ª–æ—Å—Å—è–Ω–∞–º": "–ö–æ–ª",
            "1—Ñ–µ—Å": "1–§–µ—Å", "1 —Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º": "1–§–µ—Å", "–ø–µ—Ä–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º": "1–§–µ—Å",
            "2—Ñ–µ—Å": "2–§–µ—Å", "2 —Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º": "2–§–µ—Å", "–≤—Ç–æ—Ä–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º": "2–§–µ—Å",
            "1—Ç–∏–º": "1–¢–∏–º", "1 —Ç–∏–º–æ—Ñ–µ—é": "1–¢–∏–º", "–ø–µ—Ä–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ç–∏–º–æ—Ñ–µ—é": "1–¢–∏–º",
            "2—Ç–∏–º": "2–¢–∏–º", "2 —Ç–∏–º–æ—Ñ–µ—é": "2–¢–∏–º", "–≤—Ç–æ—Ä–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ç–∏–º–æ—Ñ–µ—é": "2–¢–∏–º",
            "—Ç–∏—Ç": "–¢–∏—Ç", "—Ç–∏—Ç—É": "–¢–∏—Ç", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ç–∏—Ç—É–ª—É": "–¢–∏—Ç",
            "—Ñ–ª–º": "–§–ª–º", "—Ñ–∏–ª–∏–º–æ–Ω—É": "–§–ª–º", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Ñ–∏–ª–∏–º–æ–Ω—É": "–§–ª–º",
            "–µ–≤—Ä": "–ï–≤—Ä", "–µ–≤—Ä–µ—è–º": "–ï–≤—Ä", "–ø–æ—Å–ª–∞–Ω–∏–µ –∫ –µ–≤—Ä–µ—è–º": "–ï–≤—Ä",
            "–æ—Ç–∫—Ä": "–û—Ç–∫—Ä", "–æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ": "–û—Ç–∫—Ä", "–æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ –∏–æ–∞–Ω–Ω–∞": "–û—Ç–∫—Ä", "–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å": "–û—Ç–∫—Ä",
            # –í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç
            "–±—ã—Ç": "–ë—ã—Ç", "–±—ã—Ç–∏–µ": "–ë—ã—Ç",
            "–∏—Å—Ö": "–ò—Å—Ö", "–∏—Å—Ö–æ–¥": "–ò—Å—Ö",
            "–ª–µ–≤": "–õ–µ–≤", "–ª–µ–≤–∏—Ç": "–õ–µ–≤",
            "—á–∏—Å": "–ß–∏—Å", "—á–∏—Å–ª–∞": "–ß–∏—Å",
            "–≤—Ç–æ—Ä": "–í—Ç–æ—Ä", "–≤—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏–µ": "–í—Ç–æ—Ä",
            "–Ω–∞–≤": "–ù–∞–≤", "–∏–∏—Å—É—Å –Ω–∞–≤–∏–Ω": "–ù–∞–≤", "–Ω–∞–≤–∏–Ω": "–ù–∞–≤",
            "—Å—É–¥": "–°—É–¥", "—Å—É–¥–µ–π": "–°—É–¥",
            "—Ä—É—Ñ": "–†—É—Ñ", "—Ä—É—Ñ—å": "–†—É—Ñ",
            "1—Ü–∞—Ä": "1–¶–∞—Ä", "1 —Ü–∞—Ä—Å—Ç–≤": "1–¶–∞—Ä", "–ø–µ—Ä–≤–∞—è —Ü–∞—Ä—Å—Ç–≤": "1–¶–∞—Ä",
            "2—Ü–∞—Ä": "2–¶–∞—Ä", "2 —Ü–∞—Ä—Å—Ç–≤": "2–¶–∞—Ä", "–≤—Ç–æ—Ä–∞—è —Ü–∞—Ä—Å—Ç–≤": "2–¶–∞—Ä",
            "3—Ü–∞—Ä": "3–¶–∞—Ä", "3 —Ü–∞—Ä—Å—Ç–≤": "3–¶–∞—Ä", "—Ç—Ä–µ—Ç—å—è —Ü–∞—Ä—Å—Ç–≤": "3–¶–∞—Ä",
            "4—Ü–∞—Ä": "4–¶–∞—Ä", "4 —Ü–∞—Ä—Å—Ç–≤": "4–¶–∞—Ä", "—á–µ—Ç–≤–µ—Ä—Ç–∞—è —Ü–∞—Ä—Å—Ç–≤": "4–¶–∞—Ä",
            "1–ø–∞—Ä": "1–ü–∞—Ä", "1 –ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω": "1–ü–∞—Ä", "–ø–µ—Ä–≤–∞—è –ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω": "1–ü–∞—Ä",
            "2–ø–∞—Ä": "2–ü–∞—Ä", "2 –ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω": "2–ü–∞—Ä", "–≤—Ç–æ—Ä–∞—è –ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω": "2–ü–∞—Ä",
            "–µ–∑–¥": "–ï–∑–¥", "–µ–∑–¥—Ä–∞": "–ï–∑–¥",
            "–Ω–µ–µ–º": "–ù–µ–µ–º", "–Ω–µ–µ–º–∏—è": "–ù–µ–µ–º",
            "–µ—Å—Ñ": "–ï—Å—Ñ", "–µ—Å—Ç–µ—Ä": "–ï—Å—Ñ", "–µ—Å—Ç–∏—Ä—å": "–ï—Å—Ñ",
            "–∏–æ–≤": "–ò–æ–≤", "–π–æ–≤": "–ò–æ–≤", "–∫–Ω–∏–≥–∞ –∏–æ–≤–∞": "–ò–æ–≤",
            "–ø—Å": "–ü—Å", "–ø—Å–∞–ª—Ç–∏—Ä—å": "–ü—Å", "–ø—Å–∞–ª–º—ã": "–ü—Å", "–ø—Å–∞–ª–æ–º": "–ü—Å", "–ø—Å–∞–ª–º": "–ü—Å",
            "–ø—Ä–∏—Ç—á": "–ü—Ä–∏—Ç", "–ø—Ä–∏—Ç—á–∏": "–ü—Ä–∏—Ç", "–∫–Ω–∏–≥–∞ –ø—Ä–∏—Ç—á": "–ü—Ä–∏—Ç", "–ø—Ä–∏—Ç—á–∏ —Å–æ–ª–æ–º–æ–Ω–∞": "–ü—Ä–∏—Ç", "–ø—Ä–∏—Ç—á–∏ —Å–æ–ª–æ–º–æ–Ω–æ–≤—ã": "–ü—Ä–∏—Ç",
            "–µ–∫–∫–ª": "–ï–∫–∫–ª", "–µ–∫–∫–ª–µ—Å–∏–∞—Å—Ç": "–ï–∫–∫–ª",
            "–ø–µ—Å–Ω": "–ü–µ—Å–Ω", "–ø–µ—Å–Ω—å –ø–µ—Å–Ω–µ–π": "–ü–µ—Å–Ω",
            "–∏—Å": "–ò—Å", "–∏—Å–∞–∏—è": "–ò—Å",
            "–∏–µ—Ä": "–ò–µ—Ä", "–∏–µ—Ä–µ–º–∏—è": "–ò–µ—Ä",
            "–ø–ª–∞—á": "–ü–ª–∞—á", "–ø–ª–∞—á –∏–µ—Ä–µ–º–∏–∏": "–ü–ª–∞—á",
            "–∏–µ–∑": "–ò–µ–∑", "–∏–µ–∑–µ–∫–∏–∏–ª—å": "–ò–µ–∑",
            "–¥–∞–Ω": "–î–∞–Ω", "–¥–∞–Ω–∏–∏–ª": "–î–∞–Ω",
            "–æ—Å": "–û—Å", "–æ—Å–∏—è": "–û—Å",
            "–∏–æ–∏–ª": "–ò–æ–∏–ª",
            "–∞–º": "–ê–º", "–∞–º–æ—Å": "–ê–º",
            "–∞–≤–¥": "–ê–≤–¥", "–∞–≤–¥–∏–π": "–ê–≤–¥",
            "–∏–æ–Ω": "–ò–æ–Ω", "–∏–æ–Ω–∞": "–ò–æ–Ω",
            "–º–∏—Ö": "–ú–∏—Ö", "–º–∏—Ö–µ–π": "–ú–∏—Ö",
            "–Ω–∞—É–º": "–ù–∞—É–º",
            "–∞–≤–≤": "–ê–≤–≤", "–∞–≤–≤–∞–∫—É–º": "–ê–≤–≤",
            "—Å–æ—Ñ": "–°–æ—Ñ", "—Å–æ—Ñ–æ–Ω–∏—è": "–°–æ—Ñ",
            "–∞–≥–≥": "–ê–≥–≥", "–∞–≥–≥–µ–π": "–ê–≥–≥",
            "–∑–∞—Ö": "–ó–∞—Ö", "–∑–∞—Ö–∞—Ä–∏—è": "–ó–∞—Ö",
            "–º–∞–ª": "–ú–∞–ª", "–º–∞–ª–∞—Ö–∏—è": "–ú–∞–ª"
        }

        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–º –∏ —Å—Å—ã–ª–æ–∫
        self.book_synonyms.update({
            "–≤—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏–µ": "–í—Ç–æ—Ä", "–≤—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏—è": "–í—Ç–æ—Ä",
            "–ø—Å–∞–ª—Ç–∏—Ä—å": "–ü—Å", "–ø—Å–∞–ª–æ–º": "–ü—Å", "–ø—Å–∞–ª–º—ã": "–ü—Å", "–ø—Å": "–ü—Å",
            "–ø–µ—Å–Ω–∏ –ø–µ—Å–Ω–µ–π": "–ü–µ—Å–Ω", "–ø–µ—Å–Ω—å –ø–µ—Å–Ω–µ–π": "–ü–µ—Å–Ω", "–ø–µ—Å–Ω": "–ü–µ—Å–Ω",
            "–ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω": "–ü–∞—Ä", "–ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω 1": "1–ü–∞—Ä", "–ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω 2": "2–ü–∞—Ä",
            "—Ü–∞—Ä—Å—Ç–≤": "–¶–∞—Ä", "—Ü–∞—Ä—Å—Ç–≤ 1": "1–¶–∞—Ä", "—Ü–∞—Ä—Å—Ç–≤ 2": "2–¶–∞—Ä", "—Ü–∞—Ä—Å—Ç–≤ 3": "3–¶–∞—Ä", "—Ü–∞—Ä—Å—Ç–≤ 4": "4–¶–∞—Ä",
            "–º–∞—Ç—Ñ–µ—è": "–ú—Ñ", "–º–∞—Ç—Ñ–µ–π": "–ú—Ñ", "–æ—Ç –º–∞—Ç—Ñ–µ—è": "–ú—Ñ",
            "–º–∞—Ä–∫–∞": "–ú–∫", "–º–∞—Ä–∫": "–ú–∫", "–æ—Ç –º–∞—Ä–∫–∞": "–ú–∫",
            "–ª—É–∫–∏": "–õ–∫", "–ª—É–∫–∞": "–õ–∫", "–æ—Ç –ª—É–∫–∏": "–õ–∫",
            "–∏–æ–∞–Ω–Ω–∞": "–ò–Ω", "–∏–æ–∞–Ω–Ω": "–ò–Ω", "–æ—Ç –∏–æ–∞–Ω–Ω–∞": "–ò–Ω",
            "–ø–µ—Ç—Ä–∞": "1–ü–µ—Ç", "–ø–µ—Ç—Ä": "1–ü–µ—Ç", "–ø–µ—Ç—Ä–∞ 1": "1–ü–µ—Ç", "–ø–µ—Ç—Ä–∞ 2": "2–ü–µ—Ç",
            "—Ç–∏–º–æ—Ñ–µ—é": "–¢–∏–º", "—Ç–∏–º–æ—Ñ–µ–π": "–¢–∏–º", "—Ç–∏–º–æ—Ñ–µ—é 1": "1–¢–∏–º", "—Ç–∏–º–æ—Ñ–µ—é 2": "2–¢–∏–º",
            "–∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º": "–ö–æ—Ä", "–∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º 1": "1–ö–æ—Ä", "–∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º 2": "2–ö–æ—Ä",
            "—Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º": "–§–µ—Å", "—Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º 1": "1–§–µ—Å", "—Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º 2": "2–§–µ—Å",
            "—Ñ–∏–ª–∏–ø–ø–∏–π—Ü–∞–º": "–§–ª–ø", "—Ñ–∏–ª–∏–ø–ø–∏–π—Ü—ã": "–§–ª–ø",
            "–∫–æ–ª–æ—Å—Å—è–Ω–∞–º": "–ö–æ–ª",
            "–µ–≤—Ä–µ—è–º": "–ï–≤—Ä",
            "–∏–∞–∫–æ–≤–∞": "–ò–∞–∫", "–∏–∞–∫–æ–≤": "–ò–∞–∫",
            "–∏—É–¥—ã": "–ò—É–¥", "–∏—É–¥–∞": "–ò—É–¥",
            "–æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ": "–û—Ç–∫—Ä", "–æ—Ç–∫—Ä–æ–≤–µ–Ω–∏—è": "–û—Ç–∫—Ä", "–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å": "–û—Ç–∫—Ä",
            # –ö—Ä–∞—Ç–∫–∏–µ —Ñ–æ—Ä–º—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            "–±—ã—Ç–∏–µ": "–ë—ã—Ç", "–∏—Å—Ö–æ–¥": "–ò—Å—Ö", "–ª–µ–≤–∏—Ç": "–õ–µ–≤", "—á–∏—Å–ª–∞": "–ß–∏—Å", "–Ω–∞–≤–∏–Ω": "–ù–∞–≤", "—Å—É–¥–µ–π": "–°—É–¥", "—Ä—É—Ñ—å": "–†—É—Ñ",
            "–µ—Å—Ç–µ—Ä": "–ï—Å—Ñ", "–µ—Å—Ç–∏—Ä—å": "–ï—Å—Ñ", "–π–æ–≤": "–ò–æ–≤", "–ø—Ä–∏—Ç—á–∏": "–ü—Ä–∏—Ç", "–µ–∫–∫–ª–µ—Å–∏–∞—Å—Ç": "–ï–∫–∫–ª",
            "–∏—Å–∞–∏—è": "–ò—Å", "–∏–µ—Ä–µ–º–∏—è": "–ò–µ—Ä", "–ø–ª–∞—á –∏–µ—Ä–µ–º–∏–∏": "–ü–ª–∞—á", "–∏–µ–∑–µ–∫–∏–∏–ª—å": "–ò–µ–∑", "–¥–∞–Ω–∏–∏–ª": "–î–∞–Ω",
            "–æ—Å–∏—è": "–û—Å", "–∏–æ–∏–ª—å": "–ò–æ–∏–ª", "–∞–º–æ—Å": "–ê–º", "–∞–≤–¥–∏–π": "–ê–≤–¥", "–∏–æ–Ω–∞": "–ò–æ–Ω", "–º–∏—Ö–µ–π": "–ú–∏—Ö", "–Ω–∞—É–º": "–ù–∞—É–º",
            "–∞–≤–≤–∞–∫—É–º": "–ê–≤–≤", "—Å–æ—Ñ–æ–Ω–∏—è": "–°–æ—Ñ", "–∞–≥–≥–µ–π": "–ê–≥–≥", "–∑–∞—Ö–∞—Ä–∏—è": "–ó–∞—Ö", "–º–∞–ª–∞—Ö–∏—è": "–ú–∞–ª"
        })

        # –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏–∑ book_names.csv –∫–∞–∫ —Å–∏–Ω–æ–Ω–∏–º—ã
        en_to_ru = {
            "Gen": "–ë—ã—Ç", "Exod": "–ò—Å—Ö", "Lev": "–õ–µ–≤", "Num": "–ß–∏—Å", "Deut": "–í—Ç–æ—Ä", "Josh": "–ù–∞–≤", "Judg": "–°—É–¥", "Ruth": "–†—É—Ñ",
            "1Sam": "1–¶–∞—Ä", "2Sam": "2–¶–∞—Ä", "1Kgs": "3–¶–∞—Ä", "2Kgs": "4–¶–∞—Ä", "1Chr": "1–ü–∞—Ä", "2Chr": "2–ü–∞—Ä", "Ezra": "–ï–∑–¥", "Neh": "–ù–µ–µ–º",
            "Esth": "–ï—Å—Ñ", "Job": "–ò–æ–≤", "Ps": "–ü—Å", "Prov": "–ü—Ä–∏—Ç", "Eccl": "–ï–∫–∫–ª", "Song": "–ü–µ—Å–Ω", "Isa": "–ò—Å", "Jer": "–ò–µ—Ä",
            "Lam": "–ü–ª–∞—á", "Ezek": "–ò–µ–∑", "Dan": "–î–∞–Ω", "Hos": "–û—Å", "Joel": "–ò–æ–∏–ª", "Amos": "–ê–º", "Obad": "–ê–≤–¥", "Jonah": "–ò–æ–Ω",
            "Mic": "–ú–∏—Ö", "Nah": "–ù–∞—É–º", "Hab": "–ê–≤–≤", "Zeph": "–°–æ—Ñ", "Hag": "–ê–≥–≥", "Zech": "–ó–∞—Ö", "Mal": "–ú–∞–ª",
            "Matt": "–ú—Ñ", "Mark": "–ú–∫", "Luke": "–õ–∫", "John": "–ò–Ω", "Acts": "–î–µ—è–Ω", "Jas": "–ò–∞–∫", "1Pet": "1–ü–µ—Ç", "2Pet": "2–ü–µ—Ç",
            "1John": "1–ò–Ω", "2John": "2–ò–Ω", "3John": "3–ò–Ω", "Jude": "–ò—É–¥", "Rom": "–†–∏–º", "1Cor": "1–ö–æ—Ä", "2Cor": "2–ö–æ—Ä",
            "Gal": "–ì–∞–ª", "Eph": "–ï—Ñ", "Phil": "–§–ª–ø", "Col": "–ö–æ–ª", "1Thess": "1–§–µ—Å", "2Thess": "2–§–µ—Å", "1Tim": "1–¢–∏–º",
            "2Tim": "2–¢–∏–º", "Titus": "–¢–∏—Ç", "Phlm": "–§–ª–º", "Heb": "–ï–≤—Ä", "Rev": "–û—Ç–∫—Ä"
        }
        for en, ru in en_to_ru.items():
            self.book_synonyms[en.lower()] = ru
            # —á—Ç–æ–±—ã normalize_book_name("–±—ã—Ç") ‚Üí "–ë—ã—Ç"
            self.book_synonyms[ru.lower()] = ru

        self.load_data()

    def load_data(self) -> None:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Excel —Ñ–∞–π–ª–æ–≤."""
        try:
            # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–Ω–∏–≥
            self.books_df = pd.read_excel(EXCEL_FILES["books"])
            self.book_names = self.books_df["–ö–Ω–∏–≥–∞ –ë–∏–±–ª–∏–∏"].tolist()
            self.book_values = self.books_df["book"].tolist()
            self.book_dict = dict(zip(self.book_values, self.book_names))

            # –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç books –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            self.books = self.book_dict

            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥–ª–∞–≤
            # –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω—ã –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤ self.max_chapters –∏ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏
            correct_chapters = self.max_chapters.copy()

            # –õ–æ–≥–≥–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤–∞–∂–Ω—ã—Ö –∫–Ω–∏–≥
            logger.info("–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≥–ª–∞–≤ –¥–ª—è –∫–Ω–∏–≥:")
            # 1 –ü–µ—Ç—Ä–∞ (46), 2 –ü–µ—Ç—Ä–∞ (47), 1 –ò–æ–∞–Ω–Ω–∞ (48), 2 –§–µ—Å (60), 1 –¢–∏–º (61)
            for book_id in [46, 47, 48, 60, 61]:
                book_name = self.book_dict.get(book_id, f'ID {book_id}')
                chapters = correct_chapters.get(book_id)
                logger.info(f"  {book_name}: {chapters} –≥–ª–∞–≤")

            # –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–ª–∞–≤ –∏–∑ Excel
            if "–ì–ª–∞–≤—ã" in self.books_df.columns:
                excel_chapters_count = {}
                for _, row in self.books_df.iterrows():
                    book_id = row["book"]
                    chapters = row["–ì–ª–∞–≤—ã"]
                    if pd.notnull(chapters) and isinstance(chapters, (int, float)):
                        excel_chapters_count[book_id] = int(chapters)

                # –õ–æ–≥–≥–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Excel –¥–ª—è —Ç–µ—Ö –∂–µ –∫–Ω–∏–≥
                logger.info("–ó–Ω–∞—á–µ–Ω–∏—è –≥–ª–∞–≤ –∏–∑ Excel:")
                # 1 –ü–µ—Ç—Ä–∞ (46), 2 –ü–µ—Ç—Ä–∞ (47), 1 –ò–æ–∞–Ω–Ω–∞ (48), 2 –§–µ—Å (60), 1 –¢–∏–º (61)
                for book_id in [46, 47, 48, 60, 61]:
                    book_name = self.book_dict.get(book_id, f'ID {book_id}')
                    chapters = excel_chapters_count.get(book_id)
                    logger.info(f"  {book_name}: {chapters} –≥–ª–∞–≤")

                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è
                discrepancies = []
                for book_id, correct_value in correct_chapters.items():
                    if book_id in excel_chapters_count and excel_chapters_count[book_id] != correct_value:
                        discrepancies.append(
                            (book_id, correct_value, excel_chapters_count[book_id]))

                if discrepancies:
                    logger.warning(
                        f"–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≥–ª–∞–≤:")
                    for book_id, correct_value, excel_value in discrepancies:
                        book_name = self.book_dict.get(
                            book_id, f'ID {book_id}')
                        logger.warning(
                            f"  {book_name}: Excel={excel_value}, –ü—Ä–∞–≤–∏–ª—å–Ω–æ={correct_value}")

                # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                self.max_chapters = correct_chapters

                # –í–ê–ñ–ù–û: –í—Ç–æ—Ä–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –ü–µ—Ç—Ä–∞ (ID 47) –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å 3 –≥–ª–∞–≤—ã
                if 47 in self.max_chapters:
                    self.max_chapters[47] = 3
                    logger.info(
                        f"–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 3 –≥–ª–∞–≤—ã –¥–ª—è 2 –ü–µ—Ç—Ä–∞ (ID 47)")

                logger.info("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥–ª–∞–≤")

            # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∞ —á—Ç–µ–Ω–∏—è
            self.plan_df = pd.read_excel(EXCEL_FILES["reading_plan"])
            self.plan_df["day"] = self.plan_df["day"].dt.strftime("%Y-%m-%d")

            logger.info("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Excel —Ñ–∞–π–ª–æ–≤")
        except FileNotFoundError as e:
            logger.error(f"–û—à–∏–±–∫–∞: —Ñ–∞–π–ª {e.filename} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            raise
        except KeyError as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ Excel: {e}")
            raise

    def get_book_name(self, book_id: int) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –ø–æ –µ—ë ID."""
        return self.book_dict.get(book_id, f"–ö–Ω–∏–≥–∞ {book_id}")

    def get_book_id(self, abbr: str) -> Optional[int]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –∫–Ω–∏–≥–∏ –ø–æ –µ—ë —Å–æ–∫—Ä–∞—â–µ–Ω–∏—é."""
        return self.book_abbr_dict.get(abbr)

    def is_valid_chapter(self, book_id: int, chapter: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∫–∞–∑–∞–Ω–Ω–∞—è –≥–ª–∞–≤–∞ –≤ –∫–Ω–∏–≥–µ."""
        if book_id not in self.max_chapters:
            return False
        return 1 <= chapter <= self.max_chapters[book_id]

    def get_daily_reading(self, date: Optional[datetime] = None) -> Optional[dict]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–ª–∞–Ω —á—Ç–µ–Ω–∏—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É.

        Args:
            date: –î–∞—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω —á—Ç–µ–Ω–∏—è.
                 –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞.

        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–ª–∞–Ω–∞ —á—Ç–µ–Ω–∏—è –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É –Ω–µ—Ç –ø–ª–∞–Ω–∞.
        """
        if date is None:
            date = datetime.now()

        date_str = date.strftime("%Y-%m-%d")
        plan_rows = self.plan_df[self.plan_df["day"] == date_str]

        if plan_rows.empty:
            return None

        return plan_rows.iloc[0].to_dict()

    def normalize_book_name(self, name: str) -> str:
        """
        –ü—Ä–∏–≤–æ–¥–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É —Å–æ–∫—Ä–∞—â–µ–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–æ—Ç –∏–æ–∞–Ω–Ω–∞' -> '–ò–Ω').
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∏–ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
        """
        name = name.strip().lower()
        return self.book_synonyms.get(name, name.capitalize())

    def parse_reference(self, reference: str) -> Optional[Tuple[int, int, Optional[int], Optional[int]]]:
        """
        –ü–∞—Ä—Å–∏—Ç –±–∏–±–ª–µ–π—Å–∫—É—é —Å—Å—ã–ª–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (book_id, chapter, start_verse, end_verse)

        Args:
            reference: –ë–∏–±–ª–µ–π—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ú—Ñ 5:3-12", "–ò–Ω 3:16", "–ë—ã—Ç 1")

        Returns:
            –ö–æ—Ä—Ç–µ–∂ (book_id, chapter, start_verse, end_verse) –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
        """
        import re

        # –ü—Ä–∏–º–µ—Ä: –ò–Ω 3:16-18 –∏–ª–∏ –æ—Ç –∏–æ–∞–Ω–Ω–∞ 3:16
        match = re.match(
            r'^([–∞-—è–ê-–Ø—ë–Å0-9\s]+)\s+(\d+)(?::(\d+)(?:-(\d+))?)?$', reference.strip(), re.IGNORECASE)
        if not match:
            return None

        book_raw = match.group(1).strip()
        chapter = int(match.group(2))
        verse = match.group(3)
        verse_end = match.group(4)

        # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–Ω–∏–≥–∏
        book_abbr = self.normalize_book_name(book_raw)
        if not book_abbr:
            return None

        # –ü–æ–ª—É—á–∞–µ–º ID –∫–Ω–∏–≥–∏
        book_id = self.get_book_id(book_abbr)
        if not book_id:
            return None

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≥–ª–∞–≤—ã
        if not self.is_valid_chapter(book_id, chapter):
            return None

        if verse and verse_end:
            return (book_id, chapter, int(verse), int(verse_end))
        elif verse:
            return (book_id, chapter, int(verse), None)
        else:
            return (book_id, chapter, None, None)


# –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
bible_data = BibleData()


def get_english_book_abbreviation(book_id):
    """
    –ü–æ–ª—É—á–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ –ø–æ ID –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∏ –ò–ò.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
    """
    en_to_ru = {
        "Gen": "–ë—ã—Ç", "Exod": "–ò—Å—Ö", "Lev": "–õ–µ–≤", "Num": "–ß–∏—Å", "Deut": "–í—Ç–æ—Ä",
        "Josh": "–ù–∞–≤", "Judg": "–°—É–¥", "Ruth": "–†—É—Ñ",
        "1Sam": "1–¶–∞—Ä", "2Sam": "2–¶–∞—Ä", "1Kgs": "3–¶–∞—Ä", "2Kgs": "4–¶–∞—Ä",
        "1Chr": "1–ü–∞—Ä", "2Chr": "2–ü–∞—Ä", "Ezra": "–ï–∑–¥", "Neh": "–ù–µ–µ–º",
        "Esth": "–ï—Å—Ñ", "Job": "–ò–æ–≤", "Ps": "–ü—Å", "Prov": "–ü—Ä–∏—Ç",
        "Eccl": "–ï–∫–∫–ª", "Song": "–ü–µ—Å–Ω", "Isa": "–ò—Å", "Jer": "–ò–µ—Ä",
        "Lam": "–ü–ª–∞—á", "Ezek": "–ò–µ–∑", "Dan": "–î–∞–Ω", "Hos": "–û—Å",
        "Joel": "–ò–æ–∏–ª", "Amos": "–ê–º", "Obad": "–ê–≤–¥", "Jonah": "–ò–æ–Ω",
        "Mic": "–ú–∏—Ö", "Nah": "–ù–∞—É–º", "Hab": "–ê–≤–≤", "Zeph": "–°–æ—Ñ",
        "Hag": "–ê–≥–≥", "Zech": "–ó–∞—Ö", "Mal": "–ú–∞–ª",
        "Matt": "–ú—Ñ", "Mark": "–ú–∫", "Luke": "–õ–∫", "John": "–ò–Ω",
        "Acts": "–î–µ—è–Ω", "Jas": "–ò–∞–∫", "1Pet": "1–ü–µ—Ç", "2Pet": "2–ü–µ—Ç",
        "1John": "1–ò–Ω", "2John": "2–ò–Ω", "3John": "3–ò–Ω", "Jude": "–ò—É–¥",
        "Rom": "–†–∏–º", "1Cor": "1–ö–æ—Ä", "2Cor": "2–ö–æ—Ä",
        "Gal": "–ì–∞–ª", "Eph": "–ï—Ñ", "Phil": "–§–ª–ø", "Col": "–ö–æ–ª",
        "1Thess": "1–§–µ—Å", "2Thess": "2–§–µ—Å", "1Tim": "1–¢–∏–º",
        "2Tim": "2–¢–∏–º", "Titus": "–¢–∏—Ç", "Phlm": "–§–ª–º", "Heb": "–ï–≤—Ä", "Rev": "–û—Ç–∫—Ä"
    }

    # –ü–æ–ª—É—á–∞–µ–º —Ä—É—Å—Å–∫–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–Ω–∏–≥–∏
    book_abbr = None
    for abbr, b_id in bible_data.book_abbr_dict.items():
        if b_id == book_id:
            book_abbr = abbr
            break

    if not book_abbr:
        return None

    # –ò—â–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ
    for en, ru in en_to_ru.items():
        if ru == book_abbr:
            return en

    return None


async def create_chapter_action_buttons(book_id, chapter, en_book=None, exclude_ai=False, user_id=None):
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –≥–ª–∞–≤—ã (–¢–æ–ª–∫–æ–≤–∞–Ω–∏–µ –õ–æ–ø—É—Ö–∏–Ω–∞ –∏ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò).
    –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        book_id: ID –∫–Ω–∏–≥–∏
        chapter: –Ω–æ–º–µ—Ä –≥–ª–∞–≤—ã
        en_book: –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ (–µ—Å–ª–∏ None, –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        exclude_ai: –µ—Å–ª–∏ True, –∏—Å–∫–ª—é—á–∞–µ—Ç –∫–Ω–æ–ø–∫—É AI —Ä–∞–∑–±–æ—Ä–∞
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π

    Returns:
        list: –°–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
    """
    from aiogram.types import InlineKeyboardButton
    from config.settings import ENABLE_LOPUKHIN_COMMENTARY
    from config.ai_settings import ENABLE_GPT_EXPLAIN

    if en_book is None:
        en_book = get_english_book_abbreviation(book_id)

    buttons = []

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è –µ—Å–ª–∏ user_id –ø–µ—Ä–µ–¥–∞–Ω
    saved_ai_commentary = None
    saved_lopukhin_commentary = None

    if user_id:
        try:
            from database.universal_manager import universal_db_manager

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ò–ò —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è (–¥–ª—è –≤—Å–µ–π –≥–ª–∞–≤—ã - verse 0)
            saved_ai_commentary = await universal_db_manager.get_saved_commentary(
                user_id, book_id, chapter, chapter, 0, 0, "ai"
            )

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è –õ–æ–ø—É—Ö–∏–Ω–∞ (–¥–ª—è –≤—Å–µ–π –≥–ª–∞–≤—ã - verse 0)
            saved_lopukhin_commentary = await universal_db_manager.get_saved_commentary(
                user_id, book_id, chapter, chapter, 0, 0, "lopukhin"
            )
        except Exception as e:
            import logging
            logger = logging.getLogger(__name__)
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π: {e}")

    # –ö–Ω–æ–ø–∫–∞ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è –õ–æ–ø—É—Ö–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å en_book)
    if ENABLE_LOPUKHIN_COMMENTARY and en_book:
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è
        lopukhin_text = "üìö –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ –õ–æ–ø—É—Ö–∏–Ω–∞" if saved_lopukhin_commentary else "–¢–æ–ª–∫–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ. –õ–æ–ø—É—Ö–∏–Ω–∞"

        buttons.append([
            InlineKeyboardButton(
                text=lopukhin_text,
                callback_data=f"open_commentary_{en_book}_{chapter}_0"
            )
        ])

    # –ö–Ω–æ–ø–∫–∞ –ò–ò —Ä–∞–∑–±–æ—Ä–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏ –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∞)
    if ENABLE_GPT_EXPLAIN and not exclude_ai:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º en_book –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ UNKNOWN
        book_param = en_book if en_book else "UNKNOWN"

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è
        ai_text = "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ –ò–ò" if saved_ai_commentary else "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"

        buttons.append([
            InlineKeyboardButton(
                text=ai_text,
                callback_data=f"gpt_explain_{book_param}_{chapter}_0"
            )
        ])

    return buttons
