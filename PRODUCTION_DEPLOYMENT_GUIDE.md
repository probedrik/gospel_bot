# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ VPS](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-vps)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase RLS](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-supabase-rls)
3. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–±–æ—Ç–∞)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
5. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
6. [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

# üñ•Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ VPS

## üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–û–°**: Ubuntu 20.04+ –∏–ª–∏ CentOS 8+
- **RAM**: –ú–∏–Ω–∏–º—É–º 1GB, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2GB+
- **CPU**: 1 vCPU (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞)
- **–î–∏—Å–∫**: 20GB+ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **–°–µ—Ç—å**: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤
sudo reboot
```

## üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p /opt/gospel-bot/{data,logs,config}
cd /opt/gospel-bot

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–æ—Ç–∞
sudo useradd -r -s /bin/false -d /opt/gospel-bot botuser
sudo chown -R botuser:botuser /opt/gospel-bot
```

---

# üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase RLS

## üîê –í–∫–ª—é—á–µ–Ω–∏–µ Row Level Security

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫

```sql
-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase SQL Editor

-- –í–∫–ª—é—á–µ–Ω–∏–µ RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
CREATE POLICY "Users can view own data" ON users
    FOR SELECT USING (auth.uid() = id::text OR telegram_id = current_setting('app.current_user_telegram_id')::bigint);

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
CREATE POLICY "Users can update own data" ON users
    FOR UPDATE USING (telegram_id = current_setting('app.current_user_telegram_id')::bigint);

-- –ü–æ–ª–∏—Ç–∏–∫–∞: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE POLICY "Allow user creation" ON users
    FOR INSERT WITH CHECK (true);

-- –í–∫–ª—é—á–µ–Ω–∏–µ RLS –¥–ª—è –∑–∞–∫–ª–∞–¥–æ–∫
ALTER TABLE bookmarks ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–ª–∞–¥–∫–∏
CREATE POLICY "Users can view own bookmarks" ON bookmarks
    FOR ALL USING (user_id = (
        SELECT id FROM users WHERE telegram_id = current_setting('app.current_user_telegram_id')::bigint
    ));

-- –í–∫–ª—é—á–µ–Ω–∏–µ RLS –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á—Ç–µ–Ω–∏—è
ALTER TABLE user_reading_progress ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
CREATE POLICY "Users can view own progress" ON user_reading_progress
    FOR ALL USING (user_id = (
        SELECT id FROM users WHERE telegram_id = current_setting('app.current_user_telegram_id')::bigint
    ));

-- –¢–∞–±–ª–∏—Ü—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (–±–µ–∑ RLS)
-- books, verses, themes, reading_plans, calendar_events
-- –≠—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –¥–ª—è —á—Ç–µ–Ω–∏—è
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE FUNCTION set_current_user_telegram_id(telegram_id bigint)
RETURNS void AS $$
BEGIN
    PERFORM set_config('app.current_user_telegram_id', telegram_id::text, true);
END;
$$ LANGUAGE plpgsql;

-- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
GRANT EXECUTE ON FUNCTION set_current_user_telegram_id TO anon, authenticated;
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Service Role

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ –¥–ª—è –±–æ—Ç–∞ —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
-- –í Supabase Dashboard -> Settings -> API
-- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ service_role key –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –±–æ—Ç–∞

-- –î–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤)
GRANT SELECT ON books, verses, themes, reading_plans, calendar_events TO anon;
```

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –±–æ—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RLS

```python
# services/database.py
import asyncio
from supabase import create_client, Client
import logging

logger = logging.getLogger(__name__)

class SupabaseManager:
    def __init__(self, url: str, service_key: str):
        self.client: Client = create_client(url, service_key)
        
    async def set_user_context(self, telegram_id: int):
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è RLS"""
        try:
            await asyncio.to_thread(
                self.client.rpc,
                'set_current_user_telegram_id',
                {'telegram_id': telegram_id}
            )
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {telegram_id}: {e}")
    
    async def add_user(self, telegram_id: int, username: str, first_name: str):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
        try:
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
            await self.set_user_context(telegram_id)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            existing = await asyncio.to_thread(
                self.client.table('users')
                .select('id')
                .eq('telegram_id', telegram_id)
                .execute
            )
            
            if not existing.data:
                # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                result = await asyncio.to_thread(
                    self.client.table('users')
                    .insert({
                        'telegram_id': telegram_id,
                        'username': username,
                        'first_name': first_name,
                        'created_at': 'now()',
                        'ai_usage_count': 0,
                        'ai_usage_date': 'CURRENT_DATE'
                    })
                    .execute
                )
                logger.info(f"–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {telegram_id}")
                return result.data[0]
            else:
                return existing.data[0]
                
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {telegram_id}: {e}")
            raise
```

---

# ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞

## üìÑ –°–æ–∑–¥–∞–Ω–∏–µ docker-compose.yml

```yaml
# /opt/gospel-bot/docker-compose.yml
version: '3.8'

services:
  gospel-bot:
    image: probedrik/gospel-bot:latest
    container_name: gospel-bot-production
    restart: unless-stopped
    environment:
      # Telegram Bot
      - BOT_TOKEN=${BOT_TOKEN}
      
      # Supabase
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      
      # OpenRouter AI
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - OPENROUTER_PREMIUM_API_KEY=${OPENROUTER_PREMIUM_API_KEY}
      
      # Analytics
      - GOOGLE_ANALYTICS_ID=${GOOGLE_ANALYTICS_ID}
      - MIXPANEL_TOKEN=${MIXPANEL_TOKEN}
      
      # Payment
      - YOOKASSA_SHOP_ID=${YOOKASSA_SHOP_ID}
      - YOOKASSA_SECRET_KEY=${YOOKASSA_SECRET_KEY}
      
      # Monitoring
      - SENTRY_DSN=${SENTRY_DSN}
      
      # Admin
      - ADMIN_USER_ID=${ADMIN_USER_ID}
      
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    
    networks:
      - gospel-bot-network
    
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8000/health', timeout=10)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Nginx –¥–ª—è –≤–µ–±-—Ö—É–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  nginx:
    image: nginx:alpine
    container_name: gospel-bot-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    networks:
      - gospel-bot-network
    depends_on:
      - gospel-bot

networks:
  gospel-bot-network:
    driver: bridge
```

## üîê –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
# /opt/gospel-bot/.env

# Telegram
BOT_TOKEN=your_bot_token_here
ADMIN_USER_ID=your_telegram_id

# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_service_role_key_here

# OpenRouter
OPENROUTER_API_KEY=your_openrouter_key
OPENROUTER_PREMIUM_API_KEY=your_premium_key

# Analytics
GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX
MIXPANEL_TOKEN=your_mixpanel_token

# Payment
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key

# Monitoring
SENTRY_DSN=https://your-sentry-dsn

# Security
chmod 600 .env
```

---

# üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üìà Google Analytics 4

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GA4

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ Google Analytics —Å–≤–æ–π—Å—Ç–≤–∞
1. –ó–∞–π—Ç–∏ –≤ https://analytics.google.com
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ
3. –í–∫–ª—é—á–∏—Ç—å Enhanced Ecommerce
4. –ü–æ–ª—É—á–∏—Ç—å Measurement ID (G-XXXXXXXXXX)
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç

```python
# services/analytics.py
import aiohttp
import asyncio
import logging
from typing import Dict, Any
import uuid
from datetime import datetime

logger = logging.getLogger(__name__)

class AnalyticsManager:
    def __init__(self, ga_measurement_id: str, ga_api_secret: str):
        self.ga_measurement_id = ga_measurement_id
        self.ga_api_secret = ga_api_secret
        self.ga_endpoint = f"https://www.google-analytics.com/mp/collect"
        
    async def track_event(self, user_id: int, event_name: str, parameters: Dict[str, Any] = None):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ Google Analytics"""
        if parameters is None:
            parameters = {}
            
        # –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        base_params = {
            'user_id': str(user_id),
            'session_id': str(uuid.uuid4()),
            'timestamp_micros': int(datetime.now().timestamp() * 1000000)
        }
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        parameters.update(base_params)
        
        payload = {
            'client_id': str(user_id),
            'events': [{
                'name': event_name,
                'params': parameters
            }]
        }
        
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(
                    self.ga_endpoint,
                    params={
                        'measurement_id': self.ga_measurement_id,
                        'api_secret': self.ga_api_secret
                    },
                    json=payload
                ) as response:
                    if response.status == 200:
                        logger.debug(f"GA event sent: {event_name}")
                    else:
                        logger.error(f"GA error: {response.status}")
        except Exception as e:
            logger.error(f"Analytics error: {e}")

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
analytics = AnalyticsManager(
    ga_measurement_id=os.getenv('GOOGLE_ANALYTICS_ID'),
    ga_api_secret=os.getenv('GA_API_SECRET')
)
```

### 3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö

```python
# handlers/commands.py
from services.analytics import analytics

@router.message(Command("start"))
async def start_command(message: Message, state: FSMContext, db=None):
    user_id = message.from_user.id
    
    # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞
    await analytics.track_event(
        user_id=user_id,
        event_name='bot_start',
        parameters={
            'platform': 'telegram',
            'user_type': 'new' if not await db.user_exists(user_id) else 'returning'
        }
    )
    
    # –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã...

# handlers/text_messages.py
@router.message(F.text == "üìñ –í—ã–±—Ä–∞—Ç—å –∫–Ω–∏–≥—É")
async def select_book(message: Message, state: FSMContext):
    user_id = message.from_user.id
    
    # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –∫–Ω–∏–≥–∏
    await analytics.track_event(
        user_id=user_id,
        event_name='book_selection_started',
        parameters={
            'source': 'main_menu'
        }
    )

# handlers/ai_assistant.py
async def process_ai_request(message: Message, user_id: int, verses: list):
    # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ò–ò
    await analytics.track_event(
        user_id=user_id,
        event_name='ai_explanation_requested',
        parameters={
            'verses_count': len(verses),
            'ai_type': 'regular',  # –∏–ª–∏ 'premium'
            'content_type': 'verse_explanation'
        }
    )
```

## üìä Mixpanel –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

```python
# services/mixpanel_analytics.py
import aiohttp
import base64
import json
import time

class MixpanelAnalytics:
    def __init__(self, token: str):
        self.token = token
        self.endpoint = "https://api.mixpanel.com/track"
    
    async def track(self, user_id: int, event: str, properties: dict = None):
        if properties is None:
            properties = {}
            
        properties.update({
            'token': self.token,
            'distinct_id': str(user_id),
            'time': int(time.time()),
            '$insert_id': f"{user_id}_{event}_{int(time.time())}"
        })
        
        data = {
            'event': event,
            'properties': properties
        }
        
        encoded_data = base64.b64encode(json.dumps(data).encode()).decode()
        
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(
                    self.endpoint,
                    data={'data': encoded_data}
                ) as response:
                    return response.status == 200
        except Exception as e:
            logger.error(f"Mixpanel error: {e}")
            return False
```

## üìà –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ Supabase

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
CREATE TABLE analytics_events (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    telegram_id BIGINT,
    event_name VARCHAR(100) NOT NULL,
    event_properties JSONB DEFAULT '{}',
    session_id UUID,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    user_agent TEXT,
    ip_address INET
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_analytics_events_user_id ON analytics_events(user_id);
CREATE INDEX idx_analytics_events_event_name ON analytics_events(event_name);
CREATE INDEX idx_analytics_events_timestamp ON analytics_events(timestamp);
CREATE INDEX idx_analytics_events_telegram_id ON analytics_events(telegram_id);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
CREATE TABLE daily_stats (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    total_users INTEGER DEFAULT 0,
    new_users INTEGER DEFAULT 0,
    active_users INTEGER DEFAULT 0,
    total_events INTEGER DEFAULT 0,
    ai_requests INTEGER DEFAULT 0,
    bookmarks_created INTEGER DEFAULT 0,
    UNIQUE(date)
);
```

### 2. –°–µ—Ä–≤–∏—Å –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```python
# services/internal_analytics.py
from supabase import Client
import asyncio
from datetime import datetime, date
import uuid
import logging

logger = logging.getLogger(__name__)

class InternalAnalytics:
    def __init__(self, supabase: Client):
        self.supabase = supabase
        
    async def track_event(
        self, 
        telegram_id: int, 
        event_name: str, 
        properties: dict = None,
        session_id: str = None
    ):
        """–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ"""
        if properties is None:
            properties = {}
            
        if session_id is None:
            session_id = str(uuid.uuid4())
            
        try:
            # –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_result = await asyncio.to_thread(
                self.supabase.table('users')
                .select('id')
                .eq('telegram_id', telegram_id)
                .execute
            )
            
            user_id = user_result.data[0]['id'] if user_result.data else None
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
            await asyncio.to_thread(
                self.supabase.table('analytics_events')
                .insert({
                    'user_id': user_id,
                    'telegram_id': telegram_id,
                    'event_name': event_name,
                    'event_properties': properties,
                    'session_id': session_id,
                    'timestamp': datetime.now().isoformat()
                })
                .execute
            )
            
            logger.debug(f"Internal analytics: {event_name} for user {telegram_id}")
            
        except Exception as e:
            logger.error(f"Internal analytics error: {e}")
    
    async def get_daily_stats(self, days: int = 30) -> list:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π"""
        try:
            result = await asyncio.to_thread(
                self.supabase.table('daily_stats')
                .select('*')
                .order('date', desc=True)
                .limit(days)
                .execute
            )
            return result.data
        except Exception as e:
            logger.error(f"Error getting daily stats: {e}")
            return []
    
    async def update_daily_stats(self):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        today = date.today()
        
        try:
            # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            total_users = await asyncio.to_thread(
                self.supabase.table('users')
                .select('id', count='exact')
                .execute
            )
            
            # –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            new_users = await asyncio.to_thread(
                self.supabase.table('users')
                .select('id', count='exact')
                .gte('created_at', today.isoformat())
                .execute
            )
            
            # –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            active_users = await asyncio.to_thread(
                self.supabase.table('analytics_events')
                .select('telegram_id', count='exact')
                .gte('timestamp', today.isoformat())
                .execute
            )
            
            # –ò–ò –∑–∞–ø—Ä–æ—Å—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            ai_requests = await asyncio.to_thread(
                self.supabase.table('analytics_events')
                .select('id', count='exact')
                .eq('event_name', 'ai_explanation_requested')
                .gte('timestamp', today.isoformat())
                .execute
            )
            
            # –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –¥–µ–Ω—å
            await asyncio.to_thread(
                self.supabase.table('daily_stats')
                .upsert({
                    'date': today.isoformat(),
                    'total_users': total_users.count,
                    'new_users': new_users.count,
                    'active_users': active_users.count,
                    'ai_requests': ai_requests.count
                })
                .execute
            )
            
        except Exception as e:
            logger.error(f"Error updating daily stats: {e}")
```

### 3. Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

```python
# middleware/analytics_middleware.py
from aiogram import BaseMiddleware
from aiogram.types import TelegramObject, Message, CallbackQuery
from services.internal_analytics import InternalAnalytics
import uuid

class AnalyticsMiddleware(BaseMiddleware):
    def __init__(self, analytics: InternalAnalytics):
        self.analytics = analytics
        super().__init__()

    async def __call__(
        self,
        handler,
        event: TelegramObject,
        data: dict
    ):
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º session_id –¥–ª—è —Å–µ—Å—Å–∏–∏
        if 'session_id' not in data:
            data['session_id'] = str(uuid.uuid4())
            
        # –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
        if isinstance(event, Message):
            await self._track_message(event, data['session_id'])
        elif isinstance(event, CallbackQuery):
            await self._track_callback(event, data['session_id'])
            
        return await handler(event, data)
    
    async def _track_message(self, message: Message, session_id: str):
        """–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π"""
        properties = {
            'message_type': 'text' if message.text else 'other',
            'chat_type': message.chat.type,
            'has_reply': bool(message.reply_to_message)
        }
        
        if message.text:
            if message.text.startswith('/'):
                event_name = 'command_used'
                properties['command'] = message.text.split()[0]
            else:
                event_name = 'message_sent'
                properties['text_length'] = len(message.text)
        else:
            event_name = 'media_sent'
            
        await self.analytics.track_event(
            telegram_id=message.from_user.id,
            event_name=event_name,
            properties=properties,
            session_id=session_id
        )
    
    async def _track_callback(self, callback: CallbackQuery, session_id: str):
        """–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏"""
        properties = {
            'callback_data': callback.data,
            'message_id': callback.message.message_id
        }
        
        await self.analytics.track_event(
            telegram_id=callback.from_user.id,
            event_name='button_clicked',
            properties=properties,
            session_id=session_id
        )
```

---

# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# config/logging_config.py
import logging
import logging.handlers
import os
from datetime import datetime

def setup_logging():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
    log_dir = '/app/logs'
    os.makedirs(log_dir, exist_ok=True)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    # –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–≥–µ—Ä
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)
    
    # –§–∞–π–ª–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
    file_handler = logging.handlers.RotatingFileHandler(
        f'{log_dir}/bot.log',
        maxBytes=10*1024*1024,  # 10MB
        backupCount=5
    )
    file_handler.setFormatter(formatter)
    logger.addHandler(file_handler)
    
    # –û—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥ –¥–ª—è –æ—à–∏–±–æ–∫
    error_handler = logging.handlers.RotatingFileHandler(
        f'{log_dir}/errors.log',
        maxBytes=10*1024*1024,
        backupCount=5
    )
    error_handler.setLevel(logging.ERROR)
    error_handler.setFormatter(formatter)
    logger.addHandler(error_handler)
    
    # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    logger.addHandler(console_handler)
    
    return logger
```

## üîç Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫

```python
# services/sentry_config.py
import sentry_sdk
from sentry_sdk.integrations.logging import LoggingIntegration
import os

def setup_sentry():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫"""
    sentry_dsn = os.getenv('SENTRY_DSN')
    
    if sentry_dsn:
        sentry_logging = LoggingIntegration(
            level=logging.INFO,
            event_level=logging.ERROR
        )
        
        sentry_sdk.init(
            dsn=sentry_dsn,
            integrations=[sentry_logging],
            traces_sample_rate=0.1,
            environment="production"
        )
```

## üìà Health Check —ç–Ω–¥–ø–æ–∏–Ω—Ç

```python
# health_check.py
from aiohttp import web
import asyncio
import logging
from services.database import db

logger = logging.getLogger(__name__)

async def health_check(request):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞"""
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
        await db.execute_query("SELECT 1")
        
        return web.json_response({
            'status': 'healthy',
            'timestamp': datetime.now().isoformat(),
            'services': {
                'database': 'ok',
                'bot': 'running'
            }
        })
    except Exception as e:
        logger.error(f"Health check failed: {e}")
        return web.json_response({
            'status': 'unhealthy',
            'error': str(e)
        }, status=500)

# –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è health check
async def start_health_server():
    app = web.Application()
    app.router.add_get('/health', health_check)
    
    runner = web.AppRunner(app)
    await runner.setup()
    
    site = web.TCPSite(runner, '0.0.0.0', 8000)
    await site.start()
    logger.info("Health check server started on port 8000")
```

---

# üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìã –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ç–∫–∞–ø–∞ Supabase

```bash
#!/bin/bash
# /opt/gospel-bot/scripts/backup.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
BACKUP_DIR="/opt/gospel-bot/backups"
DATE=$(date +%Y%m%d_%H%M%S)
SUPABASE_PROJECT_ID="your_project_id"
SUPABASE_DB_PASSWORD="your_db_password"

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±—ç–∫–∞–ø–æ–≤
mkdir -p $BACKUP_DIR

# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
echo "Starting database backup..."
pg_dump -h db.${SUPABASE_PROJECT_ID}.supabase.co \
        -U postgres \
        -W \
        -d postgres \
        --no-owner \
        --no-privileges \
        -f ${BACKUP_DIR}/database_backup_${DATE}.sql

# –°–∂–∞—Ç–∏–µ –±—ç–∫–∞–ø–∞
gzip ${BACKUP_DIR}/database_backup_${DATE}.sql

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
find $BACKUP_DIR -name "*.gz" -mtime +30 -delete

echo "Backup completed: database_backup_${DATE}.sql.gz"

# –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ–±–ª–∞–∫–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# aws s3 cp ${BACKUP_DIR}/database_backup_${DATE}.sql.gz s3://your-bucket/backups/
```

## ‚è∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ crontab
crontab -e

# –ë—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 –Ω–æ—á–∏
0 2 * * * /opt/gospel-bot/scripts/backup.sh >> /opt/gospel-bot/logs/backup.log 2>&1

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
0 0 * * 0 find /opt/gospel-bot/logs -name "*.log" -mtime +7 -delete
```

---

# üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ UFW
sudo apt install ufw

# –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞
sudo ufw default deny incoming
sudo ufw default allow outgoing

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ SSH
sudo ufw allow ssh

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ HTTP/HTTPS (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è webhook)
sudo ufw allow 80
sudo ufw allow 443

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ñ–∞–π—Ä–≤–æ–ª–∞
sudo ufw enable
```

## üîê SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è webhook)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install certbot

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot certonly --standalone -d your-domain.com

# –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
echo "0 12 * * * /usr/bin/certbot renew --quiet" | sudo crontab -
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç–∞
- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ rate limiting
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

---

# üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

## üìù –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cd /opt/gospel-bot
cat .env | grep -v "^#" | grep -v "^$"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker --version
docker-compose --version
```

### 2. –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–∞
docker-compose pull

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs -f gospel-bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health check
curl http://localhost:8000/health
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose ps

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats gospel-bot-production

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /opt/gospel-bot/logs/bot.log
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ systemd —Å–µ—Ä–≤–∏—Å–∞
sudo tee /etc/systemd/system/gospel-bot.service > /dev/null <<EOF
[Unit]
Description=Gospel Bot
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/gospel-bot
ExecStart=/usr/local/bin/docker-compose up -d
ExecStop=/usr/local/bin/docker-compose down
TimeoutStartSec=0

[Install]
WantedBy=multi-user.target
EOF

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl enable gospel-bot.service
sudo systemctl start gospel-bot.service
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:
- [ ] VPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –°–æ–∑–¥–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### Supabase:
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –¢–∞–±–ª–∏—Ü—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- [ ] Service Role –∫–ª—é—á –ø–æ–ª—É—á–µ–Ω
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- [ ] .env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω
- [ ] docker-compose.yml –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –í—Å–µ API –∫–ª—é—á–∏ –ø–æ–ª—É—á–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
- [ ] Google Analytics –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
- [ ] Middleware –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] Sentry –ø–æ–¥–∫–ª—é—á–µ–Ω
- [ ] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- [ ] –§–∞–π—Ä–≤–æ–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã
- [ ] –°–µ–∫—Ä–µ—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ —Å–æ–∑–¥–∞–Ω
- [ ] Cron –∑–∞–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–∞–ø –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

*–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤–∞—à –±–æ—Ç –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å –ø–æ–ª–Ω—ã–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º, –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!*

