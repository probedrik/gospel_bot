# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–Ω–æ–≤ –∏–∑ Supabase v2.8.10

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞ `switch_to_supabase_plans.py`, –ø–ª–∞–Ω—ã —á—Ç–µ–Ω–∏—è –≤—Å–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –∏–∑ CSV —Ñ–∞–π–ª–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–∞–º:

```
ERROR:services.reading_plans:–ü–∞–ø–∫–∞ —Å –ø–ª–∞–Ω–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: data/plans_csv_final
INFO:services.reading_plans:üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ø–ª–∞–Ω—ã –∏–∑ Supabase:
INFO:services.reading_plans:   python switch_to_supabase_plans.py
```

## üîç –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –ø–ª–∞–Ω–æ–≤ —á—Ç–µ–Ω–∏—è (`services/universal_reading_plans.py`) –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `data/supabase_plans.conf` –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–ª –∏—Å–∫–∞—Ç—å CSV —Ñ–∞–π–ª—ã.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ v2.8.10

### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–Ω–æ–≤**
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å):
def _load_plans(self):
    # –°–Ω–∞—á–∞–ª–∞ CSV
    if self._load_from_csv():
        return
    # –ü–æ—Ç–æ–º —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
    # –ü–æ—Ç–æ–º –∑–∞–≥–ª—É—à–∫–∏

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å):  
def _load_plans(self):
    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Supabase
    if "USE_SUPABASE_PLANS=true" in config:
        if self._load_from_supabase():
            return
    # –ü–æ—Ç–æ–º CSV, —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è, Supabase fallback, –∑–∞–≥–ª—É—à–∫–∏
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_load_from_supabase()`**
- ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `SupabaseReadingPlansService`
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–ª–∞–Ω—ã –∏–∑ Supabase
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç `ReadingPlan`

### **3. –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ `SupabaseReadingPlansService`**
- ‚úÖ `get_all_plans()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–ª–∞–Ω–æ–≤
- ‚úÖ `get_plan_days(plan_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–Ω–µ–π –ø–ª–∞–Ω–∞
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º

### **4. –°–æ–∑–¥–∞–Ω —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è**
`force_switch_to_supabase_plans.py`:
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ –û—Ç–∫–ª—é—á–∞–µ—Ç CSV –ø–ª–∞–Ω—ã  
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Supabase –ø–ª–∞–Ω–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**
```bash
python force_switch_to_supabase_plans.py
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**
1. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª** `data/supabase_plans.conf`:
```ini
USE_SUPABASE_PLANS=true
CSV_PLANS_DISABLED=true
```

2. **–û—Ç–∫–ª—é—á–∏—Ç–µ CSV –ø–ª–∞–Ω—ã:**
```bash
mv data/plans_csv_final data/plans_csv_final_disabled
```

3. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:**
```bash
.\build-and-push.ps1 -Username "probedrik" -Tag "v2.8.10"
docker-compose -f docker-compose.supabase-sdk.yml up -d
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### **–í –ª–æ–≥–∞—Ö –±–æ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
INFO:services.universal_reading_plans:üîÑ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase –ø–ª–∞–Ω—ã
INFO:services.universal_reading_plans:‚úÖ –ü–ª–∞–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Supabase
```

### **–í–º–µ—Å—Ç–æ –æ—à–∏–±–æ–∫:**
```
ERROR:services.reading_plans:–ü–∞–ø–∫–∞ —Å –ø–ª–∞–Ω–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: data/plans_csv_final
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### **‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü–ª–∞–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Supabase –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
- CSV –ø–ª–∞–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–ª–∞–Ω–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Supabase (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ v2.8.8)

### **üìä –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–Ω–æ–≤:**
1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase** (`data/supabase_plans.conf`)
2. **CSV –ø–ª–∞–Ω—ã** (`data/plans_csv_final`)
3. **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è** (`data/plans_csv_backup`)
4. **Supabase fallback** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
5. **–ó–∞–≥–ª—É—à–∫–∏** (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã)

## üîß –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –ø–ª–∞–Ω—ã –≤—Å–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Supabase:

### **1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
cat data/supabase_plans.conf
# –î–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å: USE_SUPABASE_PLANS=true
```

### **2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –í .env —Ñ–∞–π–ª–µ:
USE_SUPABASE=true
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-key
```

### **3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase:**
```sql
-- –í Supabase SQL Editor:
SELECT COUNT(*) FROM reading_plans;
SELECT COUNT(*) FROM reading_plan_days;
```

### **4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:**
```bash
python force_switch_to_supabase_plans.py
```

## üìù –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã
- `services/universal_reading_plans.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- `services/supabase_reading_plans.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- `force_switch_to_supabase_plans.py` - –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- `docker-compose.supabase-sdk.yml` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ v2.8.10

–¢–µ–ø–µ—Ä—å –ø–ª–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Supabase! üéØ 