# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã bookmarks –≤ Supabase

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–í —Ç–µ–∫—É—â–µ–π —Ç–∞–±–ª–∏—Ü–µ `bookmarks` –≤ Supabase –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª—è `chapter_start` –∏ `chapter_end`, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≥–ª–∞–≤ –∏ —Å—Ç–∏—Ö–æ–≤.

## üéØ –¶–µ–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏
–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
- **–î–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≥–ª–∞–≤**: "–ë—ã—Ç 1-3", "–ü—Å 1-5"
- **–î–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Å—Ç–∏—Ö–æ–≤**: "–ò–Ω 3:16-18", "–ú—Ñ 5:3-12"
- **–ó–∞–º–µ—Ç–æ–∫ –∫ –∑–∞–∫–ª–∞–¥–∫–∞–º**: –ø–æ–ª–µ `note`

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```sql
-- –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE bookmarks_backup AS SELECT * FROM bookmarks;
```

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `supabase_bookmarks_migration.sql`:

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏
ALTER TABLE bookmarks ADD COLUMN IF NOT EXISTS chapter_start INTEGER;
ALTER TABLE bookmarks ADD COLUMN IF NOT EXISTS chapter_end INTEGER;

-- –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Å—Ç–∞—Ä–æ–π –∫–æ–ª–æ–Ω–∫–∏ chapter
UPDATE bookmarks 
SET chapter_start = chapter, chapter_end = NULL 
WHERE chapter_start IS NULL;

-- –î–µ–ª–∞–µ–º chapter_start –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ–ª–µ–º
ALTER TABLE bookmarks ALTER COLUMN chapter_start SET NOT NULL;

-- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –≥–ª–∞–≤
CREATE INDEX IF NOT EXISTS idx_bookmarks_chapters 
ON bookmarks(user_id, book_id, chapter_start, chapter_end);
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
python check_bookmarks_compatibility.py
```

### –®–∞–≥ 4: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ª–æ–Ω–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```sql
-- –û–°–¢–û–†–û–ñ–ù–û! –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
ALTER TABLE bookmarks DROP COLUMN chapter;
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ –∏ –ø–æ—Å–ª–µ

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
```sql
CREATE TABLE bookmarks (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    book_id INTEGER NOT NULL,
    chapter INTEGER NOT NULL,        -- –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ
    verse_start INTEGER,
    verse_end INTEGER,
    display_text TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```sql
CREATE TABLE bookmarks (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    book_id INTEGER NOT NULL,
    chapter INTEGER,                 -- –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)
    chapter_start INTEGER NOT NULL, -- –ù–æ–≤–æ–µ –ø–æ–ª–µ
    chapter_end INTEGER,            -- –ù–æ–≤–æ–µ –ø–æ–ª–µ
    verse_start INTEGER,
    verse_end INTEGER,
    display_text TEXT,
    note TEXT,                      -- –ù–æ–≤–æ–µ –ø–æ–ª–µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã:
```sql
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'bookmarks' 
ORDER BY ordinal_position;
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ:
```sql
SELECT user_id, book_id, chapter, chapter_start, chapter_end, verse_start, verse_end, display_text
FROM bookmarks 
LIMIT 5;
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ü–æ–ª–µ `chapter_start` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ `chapter`
- ‚úÖ –ü–æ–ª–µ `chapter_end` —Å–æ–¥–µ—Ä–∂–∏—Ç `NULL` (–¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –≥–ª–∞–≤)
- ‚úÖ –í—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ù–æ–≤—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã

## üö® –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```sql
-- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
DROP TABLE bookmarks;
ALTER TABLE bookmarks_backup RENAME TO bookmarks;

-- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_bookmarks_user_id ON bookmarks(user_id);
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Ç–∞–±–ª–∏—Ü—ã
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è SQL —Å–∫—Ä–∏–ø—Ç–æ–º
- [ ] –ó–∞–ø—É—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–∫–ª–∞–¥–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫–ª–∞–¥–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–∏–∞–ø–∞–∑–æ–Ω—ã –≥–ª–∞–≤ –∏ —Å—Ç–∏—Ö–æ–≤
- [ ] –£–¥–∞–ª–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è (–ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É:

1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ: `pg_dump --table=bookmarks`
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `supabase_bookmarks_create.sql`
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–ª–µ–π

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `check_bookmarks_compatibility.py`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (RLS policies)