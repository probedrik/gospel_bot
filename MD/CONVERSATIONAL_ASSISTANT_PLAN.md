## –¶–µ–ª—å

–°–¥–µ–ª–∞—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –ò–ò‚Äë–ø–æ–º–æ—â–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –≤–µ–¥—ë—Ç –±–µ—Å–µ–¥—É —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, ¬´–ø–æ–º–Ω–∏—Ç¬ª –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ—à–ª—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –±–∏–±–ª–µ–π—Å–∫–∏–µ –æ—Ç—Ä—ã–≤–∫–∏ –∏ –º–æ–ª–∏—Ç–≤—ã, –∞ —Ç–∞–∫–∂–µ –¥–∞—ë—Ç –∫—Ä–∞—Ç–∫–∏–µ —Å–æ–≤–µ—Ç—ã. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º —Å—Ç–∏–ª–µ–º –≤—ã–≤–æ–¥–∞ (—Ü–∏—Ç–∞—Ç–∞ + –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç), –ª–∏–º–∏—Ç–∞–º–∏ –ò–ò –∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏ (–ø—Ä–µ–º–∏—É–º‚Äë—Ä–µ–∂–∏–º).

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- –ù–∞—á–∞—Ç—å –±–µ—Å–µ–¥—É —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º, –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å/–ø—Ä–æ–±–ª–µ–º—É, –ø–æ–ª—É—á–∏—Ç—å:
  - –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç‚Äë—Å–æ–≤–µ—Ç;
  - 3‚Äì5 —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –º–µ—Å—Ç–∞ –°–≤—è—â–µ–Ω–Ω–æ–≥–æ –ü–∏—Å–∞–Ω–∏—è;
  - 1‚Äì2 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–æ–ª–∏—Ç–≤/–º–æ–ª–∏—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤;
  - –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–∞–º.
- –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –¥–∏–∞–ª–æ–≥: —É—Ç–æ—á–Ω—è—Ç—å, –ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—ä—è—Å–Ω–∏—Ç—å, ¬´–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç¬ª (–∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞).
- –ö–æ–º–∞–Ω–¥—ã:
  - ¬´ü§ñ –ò–ò‚Äë–ø–æ–º–æ—â–Ω–∏–∫¬ª –≤ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫/–≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é ‚Äî –≤—Ö–æ–¥ –≤ —á–∞—Ç‚Äë—Ä–µ–∂–∏–º;
  - ¬´‚ôªÔ∏è –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ¬ª ‚Äî —Å–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞;
  - ¬´üóÇ –ú–æ–∏ –±–µ—Å–µ–¥—ã¬ª ‚Äî –≤—ã–±–æ—Ä –ø—Ä–æ—à–ª–æ–π –±–µ—Å–µ–¥—ã;
  - ¬´üßπ –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é¬ª ‚Äî —É–¥–∞–ª–∏—Ç—å –±–µ—Å–µ–¥—ã.

## UX –∏ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

- –°–æ–æ–±—â–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ —Ä–∞–∑–¥–µ–ª ¬´—Ä–∞–∑–±–æ—Ä –≥–ª–∞–≤—ã¬ª: —Ü–∏—Ç–∞—Ç–∞ + –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç, –±–µ–∑ `<pre>`.
- –ö–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
  - ¬´–û—Ç–∫—Ä—ã—Ç—å –æ—Ç—Ä—ã–≤–æ–∫ ‚Ä¶¬ª –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–∞–π–¥–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏;
  - ¬´–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–ª–∏—Ç–≤—ã¬ª (–µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏);
  - ¬´‚ôªÔ∏è –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ¬ª, ¬´‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é¬ª.
- –î–ª–∏–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª—è—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏; –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —á–∞—Å—Ç–∏.

## –ü–∞–º—è—Ç—å –¥–∏–∞–ª–æ–≥–∞

–î–≤–µ —Å—Ç—É–ø–µ–Ω–∏:

1) –ö–æ—Ä–æ—Ç–∫–∞—è (–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è): –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Ä–µ–ø–ª–∏–∫ –≤ `FSMContext` (–¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–π –∏ –µ—Å–ª–∏ Supabase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω). FIFO, N‚âà8‚Äì12 –ø–∞—Ä ¬´user/assistant¬ª.

2) –î–æ–ª–≥–∞—è (–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è): Supabase —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase)

```sql
-- –†–∞–∑–≥–æ–≤–æ—Ä—ã
create table if not exists ai_conversations (
  id uuid primary key default gen_random_uuid(),
  user_id bigint not null,
  title text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

-- –°–æ–æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
create table if not exists ai_messages (
  id uuid primary key default gen_random_uuid(),
  conversation_id uuid not null references ai_conversations(id) on delete cascade,
  role text not null check (role in ('user', 'assistant', 'system')),
  content text not null,
  meta jsonb default '{}', -- –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏/—Ç–µ–º—ã/–º–æ–ª–∏—Ç–≤—ã
  created_at timestamptz not null default now()
);

create index if not exists idx_ai_messages_conversation_id on ai_messages(conversation_id);
```

RLS: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É (`user_id`). –î–ª—è –±–æ—Ç–∞ ‚Äî service role key (–∫–∞–∫ —Å–µ–π—á–∞—Å).

### –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

- –í –∑–∞–ø—Ä–æ—Å –Ω–∞ –º–æ–¥–µ–ª—å –≤–∫–ª—é—á–∞–µ–º:
  - —Å–∏—Å—Ç–µ–º–Ω—É—é —Ä–æ–ª—å (–ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–π —Å—Ç–∏–ª—å, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã);
  - –ø–æ—Å–ª–µ–¥–Ω–∏–µ M —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `ai_messages` (M‚âà12‚Äì20, –≤ –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤);
  - (–æ–ø—Ü.) –∫—Ä–∞—Ç–∫–æ–µ ¬´—Å–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞¬ª —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (summary) –ø—Ä–∏ –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–∞—Ö.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å—Ç–∏—Ö–æ–≤ –∏ –º–æ–ª–∏—Ç–≤

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–º

- –õ—ë–≥–∫–∏–π zero‚Äëshot –∏–∑ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å 1‚Äì3 —Ç–µ–º—ã/–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.
- –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å:
  - —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –ø–æ–¥–±–æ—Ä–∞ —Å—Ç–∏—Ö–æ–≤ (—É–ª—É—á—à–µ–Ω–Ω—ã–π `ask_gpt_bible_verses`);
  - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ `utils/topics`, `utils/bible_data`;
  - (–æ–ø—Ü.) ¬´–∫–∞—Ä—Ç–∞ —Ç–µ–º ‚Üí –º–æ–ª–∏—Ç–≤—ã/–º–æ–ª–∏—Ç–≤–æ—Å–ª–æ–≤¬ª.

### –ü—Ä–∞–≤–∏–ª–∞ –≤—ã–¥–∞—á–∏

- –í—Å–µ–≥–¥–∞ –æ—Ç–¥–∞–≤–∞—Ç—å:
  - –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç‚Äë—Å–æ–≤–µ—Ç (2‚Äì6 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π);
  - —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç–∏—Ö–∏ (3‚Äì5, —Ä—É—Å—Å–∫–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è);
  - (–µ—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ) 1‚Äì3 –º–æ–ª–∏—Ç–≤—ã/—Ä–∞–∑–¥–µ–ª–∞: ¬´–ü—Å–∞–ª—Ç–∏—Ä—å, –∫–∞—Ñ–∏–∑–º–∞ ‚Ä¶¬ª, ¬´–ú–æ–ª–∏—Ç–≤–∞ —Å–≤—è—Ç–æ–º—É ‚Ä¶¬ª, ¬´–ú–æ–ª–∏—Ç–≤–∞ –æ–± —É—Ç–µ—à–µ–Ω–∏–∏ ‚Ä¶¬ª.
- –í—ã–≤–æ–¥ ‚Äî –≤ —Å—Ç–∏–ª–µ —Ü–∏—Ç–∞—Ç—ã; –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä `handlers/ai_conversation.py`

- –°–æ—Å—Ç–æ—è–Ω–∏—è: `waiting_user_input`, `in_conversation`.
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
  - —Å—Ç–∞—Ä—Ç –±–µ—Å–µ–¥—ã (—Å–æ–∑–¥–∞–Ω–∏–µ/–≤—ã–±–æ—Ä `ai_conversations.id`);
  - –ø—Ä–∏—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `ai_messages`;
  - —Å–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∫–æ—Ä–æ—Ç–∫–∞—è –ø–∞–º—è—Ç—å + –∏—Å—Ç–æ—Ä–∏—è –∏–∑ Supabase);
  - –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ (OpenRouter) ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ —Å—Å—ã–ª–æ–∫ ‚Üí —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞;
  - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å —Å—Å—ã–ª–∫–∞–º–∏/–º–æ–ª–∏—Ç–≤–∞–º–∏.

### API‚Äë—Å–ª–æ–π `utils/api_client.py`

- `ask_gpt_chat(messages: list[dict], max_tokens: int, temperature: float)` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —á–∞—Ç–∞ (role: system/user/assistant).
- `extract_bible_refs(text: str) -> list[str]` ‚Äî –≤—ã–Ω–æ—Å —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ —Å—Å—ã–ª–æ–∫ –≤ —É—Ç–∏–ª–∏—Ç—É.
- (–æ–ø—Ü.) `class ChatSession` –¥–ª—è —É–¥–æ–±–Ω–æ–π —Å–±–æ—Ä–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ª–∏–º–∏—Ç–æ–≤.

### –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã

- `keyboards/main.py` ‚Äî ¬´ü§ñ –ò–ò‚Äë–ø–æ–º–æ—â–Ω–∏–∫¬ª;
- `keyboards/settings.py` ‚Äî ¬´–ú–æ–∏ –±–µ—Å–µ–¥—ã¬ª, ¬´–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é¬ª;
- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –∏ –º–æ–ª–∏—Ç–≤–∞–º–∏.

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª–∏–º–∏—Ç–∞–º–∏ –∏ –ø—Ä–µ–º–∏—É–º

- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å:
  - –ø—Ä–æ–≤–µ—Ä–∫–∞ `ai_quota_manager` (—Å—É—Ç–æ—á–Ω—ã–µ –ª–∏–º–∏—Ç—ã);
  - –≤—ã–±–æ—Ä –æ–±—ã—á–Ω–æ–π/–ø—Ä–µ–º–∏—É–º‚Äë–º–æ–¥–µ–ª–∏ (–∫–∞–∫ –≤ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–µ);
  - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (—Å—á—ë—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π).

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –Ø–∑—ã–∫: —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π; –±–æ–≥–æ—Å–ª–æ–≤—Å–∫–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–æ–Ω; –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö/–∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Ç–µ–º.
- –ù–∏–∫–∞–∫–∏—Ö –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö/—é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –º—è–≥–∫–∏–µ –¥–∏—Å–∫–ª–µ–π–º–µ—Ä—ã.
- –ó–∞—â–∏—Ç–∞ –æ—Ç prompt‚Äëinjection: —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ä–æ–ª—å –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ —Ä–∞–º–∫–∏.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –ß–∞—Ç‚Äë–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
AI_CHAT_MAX_TOKENS=1500
AI_CHAT_TEMPERATURE=0.4
AI_CHAT_MAX_TURNS=20   # —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `OPENROUTER_API_KEY`, `OPENROUTER_PREMIUM_API_KEY`, `OPENROUTER_PREMIUM_MODEL`.

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —à–∞–≥–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

1) –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
   - –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã `ai_conversations`, `ai_messages` (SQL –≤—ã—à–µ) –≤ –º–∏–≥—Ä–∞—Ü–∏—é Supabase;
   - –≤–∫–ª—é—á–∏—Ç—å RLS (read/write —Ç–æ–ª—å–∫–æ owner).
2) API‚Äë—É—Ä–æ–≤–µ–Ω—å:
   - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ask_gpt_chat` –∏ –≤—ã–Ω–æ—Å –ø–∞—Ä—Å–µ—Ä–∞ —Å—Å—ã–ª–æ–∫;
   - –ª–∏–º–∏—Ç—ã/–ø—Ä–µ–º–∏—É–º ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä.
3) –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
   - –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä `ai_conversation.py` + –≤–∫–ª—é—á–µ–Ω–∏–µ –≤ `bot.py`;
   - –º–µ–Ω—é –∏ –∫–Ω–æ–ø–∫–∏ –≤ `keyboards/`;
   - –∫–æ–º–∞–Ω–¥—ã ¬´–ú–æ–∏ –±–µ—Å–µ–¥—ã¬ª, ¬´–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ¬ª, ¬´–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é¬ª.
4) UX‚Äë—Å—Ç–∏–ª—å:
   - –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ü–∏—Ç–∞—Ç—ã (—á–µ—Ä–µ–∑ `format_ai_or_commentary`);
   - —Ä–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —á–∞—Å—Ç–∏.
5) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - —Å—Ü–µ–Ω–∞—Ä–∏–∏: –Ω–æ–≤–∞—è/—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –±–µ—Å–µ–¥–∞; –¥–ª–∏–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥; –Ω–µ—Ç —Å–µ—Ç–∏/Supabase; –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω; –ø—Ä–µ–º–∏—É–º.
6) –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
   - –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ `MD/AI_ASSISTANT_FEATURE.md` (–æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –¥–∏–∞–ª–æ–≥–æ–≤—ã–π —Ä–µ–∂–∏–º).

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–ª–∏–∑–∞ (–∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏)

1) MVP: –æ–¥–Ω–∞ –±–µ—Å–µ–¥–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ä–æ—Ç–∫–∞—è –ø–∞–º—è—Ç—å (FSM) + Supabase —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–∏—Ö–∏, –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –≤—ã–≤–æ–¥–∞.
2) –ò—Å—Ç–æ—Ä–∏—è –±–µ—Å–µ–¥: —Å–ø–∏—Å–æ–∫ –±–µ—Å–µ–¥, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ.
3) –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–æ–ª–∏—Ç–≤: –∫–∞—Ä—Ç–∞ ¬´—Ç–µ–º–∞ ‚Üí –º–æ–ª–∏—Ç–≤—ã¬ª, –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–ª–∏—Ç–≤—ã¬ª.
4) –°–∂–∞—Ç–∏–µ –∏—Å—Ç–æ—Ä–∏–∏: —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –¥–∏–∞–ª–æ–≥–∞—Ö.
5) –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ–ª–µ–π/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, A/B‚Äë—Ç–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞.

## –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥–ª–∏–Ω—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 12‚Äì20 —Å–æ–æ–±—â–µ–Ω–∏–π) + —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏.
- –í—ã–±–∏—Ä–∞—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏ –ø—Ä–µ–º–∏—É–º ‚Äî –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö.
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏/—Ç–µ–º—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ–¥–Ω–æ–π –±–µ—Å–µ–¥–µ.

---

–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Supabase, –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä, `ask_gpt_chat`, –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –∏ –ª–∏–º–∏—Ç—ã. –ó–∞–ø—É—Å–∫ –Ω–µ–∏–∑–º–µ–Ω–µ–Ω: `python bot.py`.


