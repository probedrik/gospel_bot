# –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≥–ª–∞–≤ v2.8.15

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–¢–∞–±–ª–∏—Ü–∞ `saved_commentaries` –∏–º–µ–ª–∞ –ø–æ–ª–µ `chapter` (–æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ), —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–ª–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≥–ª–∞–≤ —Ç–∏–ø–∞ "–ë—ã—Ç 1:1-2:25" –∏–ª–∏ "–ë—ã—Ç 1-2".

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–ó–∞–º–µ–Ω–∏–ª–∏ –ø–æ–ª–µ `chapter` –Ω–∞ –¥–≤–∞ –ø–æ–ª—è:
- `chapter_start` (INTEGER NOT NULL) - –Ω–∞—á–∞–ª—å–Ω–∞—è –≥–ª–∞–≤–∞
- `chapter_end` (INTEGER NULL) - –∫–æ–Ω–µ—á–Ω–∞—è –≥–ª–∞–≤–∞ (NULL –¥–ª—è –æ–¥–Ω–æ–π –≥–ª–∞–≤—ã)

## üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ –ë–î

### Supabase/PostgreSQL
```sql
-- –°—Ç–∞—Ä–∞—è —Å—Ö–µ–º–∞
chapter INTEGER NOT NULL

-- –ù–æ–≤–∞—è —Å—Ö–µ–º–∞  
chapter_start INTEGER NOT NULL,
chapter_end INTEGER
```

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
| –°—Å—ã–ª–∫–∞ | chapter_start | chapter_end | verse_start | verse_end |
|--------|---------------|-------------|-------------|-----------|
| "–ë—ã—Ç 1" | 1 | NULL | NULL | NULL |
| "–ë—ã—Ç 1:1" | 1 | NULL | 1 | 1 |
| "–ë—ã—Ç 1:1-31" | 1 | NULL | 1 | 31 |
| "–ë—ã—Ç 1-2" | 1 | 2 | NULL | NULL |
| "–ë—ã—Ç 1:1-2:25" | 1 | 2 | 1 | 25 |

## üîß –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### 1. –°—Ö–µ–º–∞ –ë–î
- **`supabase_create_ai_tables.sql`** - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
- **`supabase_migrate_chapter_fields.sql`** - —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### 2. Database Managers
- **`database/supabase_manager.py`** - –º–µ—Ç–æ–¥—ã —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- **`database/postgres_manager.py`** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π + —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã
- **`database/universal_manager.py`** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–µ—Ç–æ–¥–æ–≤
- **`database/db_manager.py`** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è SQLite

### 3. Handlers
- **`handlers/text_messages.py`** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã:
  - `gpt_explain_callback` - –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç callback_data
  - `reading_ai_callback` - —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å—Å—ã–ª–æ–∫ + –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
  - `save_commentary_callback` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ callback_data

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
```bash
# –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
cat supabase_migrate_chapter_fields.sql

# –ò–ª–∏ –¥–ª—è PostgreSQL (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫ –≤ —Ñ–∞–π–ª–µ)
```

### 2. –°–æ–±–µ—Ä–∏—Ç–µ –∏ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
docker build -t gospel-bot:v2.8.15 .
docker-compose -f docker-compose.test.yml down
# –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞–∑–∞ –≤ docker-compose.test.yml
docker-compose -f docker-compose.test.yml up -d

# Production
docker build -t your-registry/gospel-bot:v2.8.15 .
docker push your-registry/gospel-bot:v2.8.15
# –û–±–Ω–æ–≤–∏—Ç–µ docker-compose.supabase-sdk.yml
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
- –û—Ç–∫—Ä–æ–π—Ç–µ –ø–ª–∞–Ω —á—Ç–µ–Ω–∏—è —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –≥–ª–∞–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ë—ã—Ç 1:1-2:25")
- –ù–∞–∂–º–∏—Ç–µ "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ"
- –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ"

## üîç –§–æ—Ä–º–∞—Ç callback_data

### –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç
```
save_commentary_{book_id}_{chapter}_{verse}_{type}
```

### –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç  
```
save_commentary_{book_id}_{chapter_start}_{chapter_end}_{verse_start}_{type}
```

–ì–¥–µ:
- `chapter_end` = "0" –µ—Å–ª–∏ NULL (–æ–¥–Ω–∞ –≥–ª–∞–≤–∞)
- `verse_start` = "0" –µ—Å–ª–∏ NULL (–≤—Å—è –≥–ª–∞–≤–∞)

## üìã –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏

1. **–û–¥–Ω–∞ –≥–ª–∞–≤–∞**: "–õ–∫ 6" ‚Üí –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
2. **–û–¥–∏–Ω —Å—Ç–∏—Ö**: "–õ–∫ 6:1" ‚Üí –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å  
3. **–î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç–∏—Ö–æ–≤**: "–õ–∫ 6:1-11" ‚Üí –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
4. **–î–∏–∞–ø–∞–∑–æ–Ω –≥–ª–∞–≤**: "–ë—ã—Ç 1-2" ‚Üí –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å ‚ú®
5. **–î–∏–∞–ø–∞–∑–æ–Ω —á–µ—Ä–µ–∑ –≥–ª–∞–≤—ã**: "–ë—ã—Ç 1:1-2:25" ‚Üí –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å ‚ú®

## üÜï –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≥–ª–∞–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è—Ö  
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —Ç–∏–ø–∞ "–ë—ã—Ç 1:1-2:25"
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î** - –±–µ–∑ –Ω–µ—ë —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Å—ã–ª–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üîß Troubleshooting

### –û—à–∏–±–∫–∞ "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫ —Å—Ö–µ–º—ã

### –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Å—ã–ª–æ–∫
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å—Å—ã–ª–∫–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

### –°—Ç–∞—Ä—ã–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ UPDATE –≤ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ chapter_start –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π 