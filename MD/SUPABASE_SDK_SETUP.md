# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase —á–µ—Ä–µ–∑ Python SDK

–≠—Ç–æ—Ç –≥–∞–π–¥ –ø–æ–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–æ—Ç–∞ –∫ Supabase —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python SDK –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –∏ —É–ø—Ä–æ—â–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É.

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Supabase SDK

- ‚úÖ **–ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å SSL** - —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ HTTPS API
- ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - —Ç–æ–ª—å–∫–æ URL –∏ API –∫–ª—é—á
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ SDK
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK –æ—Ç Supabase
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Row Level Security (RLS)

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –≤ [Supabase Dashboard](https://app.supabase.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí API**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Project URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abcdefgh.supabase.co`)
   - **Anon Key** (–ø—É–±–ª–∏—á–Ω—ã–π API –∫–ª—é—á)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –ø–æ –ø—Ä–∏–º–µ—Ä—É `env.supabase.example`:

```bash
# === –ù–ê–°–¢–†–û–ô–ö–ò –ë–û–¢–ê ===
BOT_TOKEN=your_telegram_bot_token_here
ADMIN_ID=your_telegram_user_id_here

# === –ù–ê–°–¢–†–û–ô–ö–ò –ë–ê–ó–´ –î–ê–ù–ù–´–• ===
# –ò—Å–ø–æ–ª—å–∑—É–µ–º Supabase —á–µ—Ä–µ–∑ Python SDK
USE_SUPABASE=true

# === –ù–ê–°–¢–†–û–ô–ö–ò SUPABASE ===
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your_supabase_anon_key_here

# === –ù–ê–°–¢–†–û–ô–ö–ò –ò–ò ===
OPENAI_API_KEY=your_openai_api_key_here
AI_LIMIT_PER_DAY=10

# === –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ===
LOG_LEVEL=INFO
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ Supabase

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤ Supabase Dashboard –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:

```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ supabase_tables.sql
-- –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install supabase
```

–ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python test_supabase_sdk.py
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
=== –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï SUPABASE SDK ===

üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase —á–µ—Ä–µ–∑ SDK...
üìã URL: https://your-project.supabase.co
üîë Key: eyJhbGciOiJIUzI1NiIs...
‚úÖ Supabase –º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞–Ω
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π...
üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123456789...
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–µ–Ω: test_user
üìñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–ª–∞–¥–æ–∫...
‚úÖ –ó–∞–∫–ª–∞–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
üìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–ª–∞–¥–æ–∫: 1
ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –ª–∏–º–∏—Ç–æ–≤...
‚úÖ AI —Å—á–µ—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–µ–Ω
üìä AI –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è: 1
üìö –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ —á—Ç–µ–Ω–∏—è...
‚úÖ –ü–ª–∞–Ω —á—Ç–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
üìÖ –ü–ª–∞–Ω–æ–≤ —á—Ç–µ–Ω–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 1

üßπ –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...
‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã
‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ

üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!
‚úÖ Supabase SDK –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!
```

## üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
python bot.py
```

### Docker

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π Docker Compose –¥–ª—è Supabase SDK
docker-compose -f docker-compose.supabase-sdk.yml up -d
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### –û—à–∏–±–∫–∞ "SUPABASE_URL –∏ SUPABASE_KEY –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `.env` —Ñ–∞–π–ª–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `SUPABASE_URL` –∏ `SUPABASE_KEY` –∑–∞–¥–∞–Ω—ã
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –û—à–∏–±–∫–∞ "No module named 'supabase'"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install supabase
```

### –û—à–∏–±–∫–∞ "401 Unauthorized"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `anon` –∫–ª—é—á)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º–µ

### –û—à–∏–±–∫–∞ "404 Not Found" –¥–ª—è —Ç–∞–±–ª–∏—Ü

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ Supabase
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `supabase_tables.sql`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å RLS (Row Level Security)

–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω RLS, –Ω–æ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª –¥–æ—Å—Ç—É–ø–∞:

```sql
-- –û—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
ALTER TABLE bookmarks DISABLE ROW LEVEL SECURITY;
ALTER TABLE ai_usage DISABLE ROW LEVEL SECURITY;
ALTER TABLE user_reading_plans DISABLE ROW LEVEL SECURITY;
ALTER TABLE reading_progress DISABLE ROW LEVEL SECURITY;
ALTER TABLE reading_parts_progress DISABLE ROW LEVEL SECURITY;
ALTER TABLE reading_plans DISABLE ROW LEVEL SECURITY;
ALTER TABLE reading_plan_days DISABLE ROW LEVEL SECURITY;
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –±–æ—Ç–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
tail -f logs/bot.log

# Docker
docker logs -f gospel-bot-supabase
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database ‚Üí Tables** –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Logs** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

## üîÑ –ü–µ—Ä–µ—Ö–æ–¥ —Å PostgreSQL –Ω–∞ Supabase SDK

–ï—Å–ª–∏ –≤—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL:

1. **–û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª:**
   ```bash
   # –ó–∞–º–µ–Ω–∏—Ç–µ
   USE_POSTGRES=true
   # –ù–∞
   USE_SUPABASE=true
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ Supabase –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   ```bash
   SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_KEY=your_anon_key
   ```

3. **–£–¥–∞–ª–∏—Ç–µ PostgreSQL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - –ú–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å `POSTGRES_*` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç**

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `service_role` –∫–ª—é—á** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `anon` –∫–ª—é—á** –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ RLS –ø—Ä–∞–≤–∏–ª–∞** –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ API –∫–ª—é—á–∏**

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–ò–Ω–¥–µ–∫—Å—ã:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –ø–æ–ª–µ–π
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã** –≤ Supabase Dashboard
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API** quota
3. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫**

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python SDK –±–µ–∑ –ø—Ä–æ–±–ª–µ–º —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏! 