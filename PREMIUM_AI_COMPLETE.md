# ‚úÖ –ü–†–ï–ú–ò–£–ú –ò–ò –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚≠ê –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ò–ò

#### ü§ñ –û–±—ã—á–Ω—ã–π –ò–ò (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã):
- **–ú–æ–¥–µ–ª—å:** `mistralai/mistral-small-3.1-24b-instruct:free`
- **API –∫–ª—é—á:** `OPENROUTER_API_KEY` –∏–∑ .env
- **–õ–∏–º–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤:** 2048 (–ø–æ–ª–æ–≤–∏–Ω–∞ –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞ Telegram)
- **–†–æ–ª—å:** –ë–∞–∑–æ–≤—ã–π –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–π –±–æ–≥–æ—Å–ª–æ–≤
- **–°—Ç–∏–ª—å:** –ö—Ä–∞—Ç–∫–∏–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è

#### ‚≠ê –ü—Ä–µ–º–∏—É–º –ò–ò (–ø–ª–∞—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã):
- **–ú–æ–¥–µ–ª—å:** `anthropic/claude-3.5-sonnet` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ .env)
- **API –∫–ª—é—á:** `OPENROUTER_PREMIUM_API_KEY` –∏–∑ .env
- **–õ–∏–º–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤:** 3996 (–ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ Telegram)
- **–†–æ–ª—å:** –í—ã–¥–∞—é—â–∏–π—Å—è –±–æ–≥–æ—Å–ª–æ–≤ —Å –∑–Ω–∞–Ω–∏–µ–º –¥—Ä–µ–≤–Ω–∏—Ö —è–∑—ã–∫–æ–≤
- **–°—Ç–∏–ª—å:** –ü–æ–¥—Ä–æ–±–Ω—ã–π –±–æ–≥–æ—Å–ª–æ–≤—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

### üí≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∏–∑ .env

```env
# –ÆKassa –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key
YOOKASSA_WEBHOOK_SECRET=your_webhook_secret

# –ü—Ä–µ–º–∏—É–º –ò–ò
OPENROUTER_PREMIUM_API_KEY=your_premium_key
OPENROUTER_PREMIUM_MODEL=anthropic/claude-3.5-sonnet
```

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ò–ò
```python
can_use_ai, ai_type = await ai_quota_manager.check_and_increment_usage(user_id)

if ai_type == 'regular':
    # –û–±—ã—á–Ω—ã–π –ò–ò: –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç –¥–æ 2048 —Å–∏–º–≤–æ–ª–æ–≤
    response = await ask_gpt_explain(prompt)
    title = "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"
    
elif ai_type == 'premium':
    # –ü—Ä–µ–º–∏—É–º –ò–ò: –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–æ 3996 —Å–∏–º–≤–æ–ª–æ–≤
    response = await ask_gpt_explain_premium(prompt)
    title = "‚≠ê –ü—Ä–µ–º–∏—É–º —Ä–∞–∑–±–æ—Ä –æ—Ç –ò–ò"
```

### 2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
1. **–î–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã** ‚Üí –û–±—ã—á–Ω—ã–π –ò–ò (Mistral)
2. **–ü—Ä–µ–º–∏—É–º –∑–∞–ø—Ä–æ—Å—ã** ‚Üí –ü—Ä–µ–º–∏—É–º –ò–ò (Claude)
3. **–í—Å–µ –∏—Å—á–µ—Ä–ø–∞–Ω–æ** ‚Üí –û—Ç–∫–∞–∑ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∫—É–ø–∏—Ç—å –ø—Ä–µ–º–∏—É–º

### 3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- **–û–±—ã—á–Ω—ã–π –ò–ò:** "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"
- **–ü—Ä–µ–º–∏—É–º –ò–ò:** "‚≠ê –ü—Ä–µ–º–∏—É–º —Ä–∞–∑–±–æ—Ä –æ—Ç –ò–ò"

## üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ª–∏–º–∏—Ç–æ–≤ –ò–ò:
```
üìä –í–∞—à–∏ –ª–∏–º–∏—Ç—ã –ò–ò

üë§ –¢–∏–ø: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
üóìÔ∏è –°–µ–≥–æ–¥–Ω—è (2024-01-15):
‚Ä¢ –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç: 3 –∑–∞–ø—Ä–æ—Å–∞
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 2
‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å: 1
‚≠ê –ü—Ä–µ–º–∏—É–º –∑–∞–ø—Ä–æ—Å—ã: 15
‚Ä¢ –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ: 16

‚è∞ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —á–µ—Ä–µ–∑ 8 —á.
üîÑ –î–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤ 00:00 UTC
‚≠ê –ü—Ä–µ–º–∏—É–º –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Å–≥–æ—Ä–∞—é—Ç
```

### –í –ø—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø–µ:
```
‚≠ê –ü—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø –∫ –ò–ò

üß† –ü—Ä–µ–º–∏—É–º –ò–ò –ø–æ–º–æ—â–Ω–∏–∫:
‚Ä¢ –ë–æ–ª–µ–µ –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å –ò–ò (Claude 3.5 Sonnet)
‚Ä¢ –ì–ª—É–±–æ–∫–∏–π –±–æ–≥–æ—Å–ª–æ–≤—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
‚Ä¢ –ó–Ω–∞–Ω–∏–µ –¥—Ä–µ–≤–Ω–∏—Ö —è–∑—ã–∫–æ–≤ (–≥—Ä–µ—á–µ—Å–∫–∏–π, –µ–≤—Ä–µ–π—Å–∫–∏–π)
‚Ä¢ –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è—Ç–æ–æ—Ç–µ—á–µ—Å–∫–∏–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è
‚Ä¢ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–¥–æ 4000 —Å–∏–º–≤–æ–ª–æ–≤)
‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

üíé –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚Ä¢ +50 –ø—Ä–µ–º–∏—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 100‚ÇΩ
‚Ä¢ –ó–∞–ø—Ä–æ—Å—ã –Ω–µ —Å–≥–æ—Ä–∞—é—Ç (–Ω–µ—Å–≥–æ—Ä–∞–µ–º—ã–µ)
‚Ä¢ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è
‚Ä¢ –ù–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è —Å –æ–±—ã—á–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

#### `config/ai_settings.py`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—ã—á–Ω–æ–≥–æ –∏ –ø—Ä–µ–º–∏—É–º –ò–ò
- ‚úÖ –õ–∏–º–∏—Ç—ã —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ÆKassa –∏–∑ .env

#### `utils/api_client.py`
- ‚úÖ `ask_gpt_explain()` - –æ–±—ã—á–Ω—ã–π –ò–ò
- ‚úÖ `ask_gpt_explain_premium()` - –ø—Ä–µ–º–∏—É–º –ò–ò
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤

#### `services/ai_quota_manager.py`
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø –ò–ò: `(bool, str)`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–º–∏—É–º –∑–∞–ø—Ä–æ—Å–∞–º–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–≤–æ—Ç–∞—Ö

#### `handlers/text_messages.py`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –ò–ò
- ‚úÖ –†–∞–∑–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –∏ –ø—Ä–µ–º–∏—É–º
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

#### `handlers/settings.py`
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–µ–º–∏—É–º –ò–ò
- ‚úÖ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏

## üéÆ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç–∏—Ö: `–ò–Ω 3:16`
2. –ù–∞–∂–∏–º–∞–µ—Ç "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"
3. –ü–æ–ª—É—á–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ (–¥–æ 2048 —Å–∏–º–≤–æ–ª–æ–≤)
4. –ó–∞–≥–æ–ª–æ–≤–æ–∫: "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò—Å—á–µ—Ä–ø–∞–Ω—ã –¥–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç–∏—Ö: `–ü—Å 22:4`
2. –ù–∞–∂–∏–º–∞–µ—Ç "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–º–∏—É–º –ò–ò
4. –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–¥–æ 3996 —Å–∏–º–≤–æ–ª–æ–≤)
5. –ó–∞–≥–æ–ª–æ–≤–æ–∫: "‚≠ê –ü—Ä–µ–º–∏—É–º —Ä–∞–∑–±–æ—Ä –æ—Ç –ò–ò"

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—Å–µ –ª–∏–º–∏—Ç—ã –∏—Å—á–µ—Ä–ø–∞–Ω—ã
1. –ù–∞–∂–∏–º–∞–µ—Ç "ü§ñ –†–∞–∑–±–æ—Ä –æ—Ç –ò–ò"
2. –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```
   ‚ùå –í—Å–µ –ª–∏–º–∏—Ç—ã –ò–ò –∏—Å—á–µ—Ä–ø–∞–Ω—ã (–¥–æ—Å—Ç—É–ø–Ω–æ: 0).
   –î–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã –æ–±–Ω–æ–≤—è—Ç—Å—è —á–µ—Ä–µ–∑ 8 —á.
   –ò–ª–∏ –∫—É–ø–∏—Ç–µ –ø—Ä–µ–º–∏—É–º –∑–∞–ø—Ä–æ—Å—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
   ```

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –ò–ò
- ‚úÖ –†–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env —Ñ–∞–π–ª–∞
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–ª–∞—Ç–µ–∂–µ–π

### üîÑ –û—Å—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å:
- üîÑ –ÆKassa API –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- üîÑ Webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π

### üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞ —Ä–∞–∑—É–º–Ω—É—é —Ü–µ–Ω—É
- **–î–ª—è –ø—Ä–æ–µ–∫—Ç–∞:** –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è:** –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º

## üéØ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!